"use strict";{const e={};e.version="0.9.3",e.routing_path;let t={},n={},s={};const r=()=>"undefined"!=typeof rkn_server_generated&&rkn_server_generated,a=()=>"undefined"!=typeof rkn_generate_code&&rkn_generate_code;let i=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","controls","checked","default","defer","disabled","formnovalidate","hidden","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","truespeed"];const d=["break","case","catch","class","const","continue","debugger","default","delete","do","else","export","extends","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","try","typeof","var","void","while","with"],l=e=>0<=d.indexOf(e),h=(e,t,n,r,a,d,c,p,m,g,b,x,$,v)=>{if("TEMPLATE"==t.tagName)return;let E=Object.keys(t.dataset).sort();if(E.indexOf("data-component")){let e=!1;for(let n of E)n.startsWith("bind")&&(t.setAttribute("data-on1-"+n.substring(4),t.dataset[n]+"=e.detail.value"),e=!0);e&&(E=Object.keys(t.dataset).sort())}if(0<E.length){if(e){let e=["component"];for(let t of E)(0<t.startsWith("arg")||0<t.startsWith("bind"))&&e.push(t);for(let t of e){let e=E.indexOf(t);0<=e&&E.splice(e,1)}}else if(0<=E.indexOf("component")){let e=["component"];for(let t of E)(t.startsWith("arg")||t.startsWith("bind")||t.startsWith("action1")||t.startsWith("style1")||t.startsWith("class1")||t.startsWith("if1")||t.startsWith("on1")||t.startsWith("attr1")||t.startsWith("timer1")||t.startsWith("interval1")||t.startsWith("route1")||t.startsWith("rest1")||t.startsWith("rest-options1")||t.startsWith("calc1")||t.startsWith("ref1"))&&e.push(t);E=e}let k=[],I=["route","ref1","style1","if1","action1","on1","attr1","class1","ref","component","style","if","for","calc","attrName","attrMin","attrMax","attrValue","value"];for(let e of I){let t=E.indexOf(e);0<=t&&(k.push(e),E.splice(t,1))}for(let e of E)k.push(e);let O="    ";for(let E of k){let k=t.dataset[E],I="";switch(""!=t.id&&"this.$root"!=n&&n===r&&(n="document.getElementById('"+t.id+"')"),E){case"ref1":if(e)break;case"ref":"undefined"==typeof a?p.first.push(O+k+" = "+n+";"):(console.error(n,r,k),v.push([k,n.split(".").slice(1).join(".")]),p.third.push(O+k+" = "+n+";"),console.error("ref add "+k+n));break;case"text":p.third.push(O+"$v = `"+k+"`;\n    if ("+n+".textContent !== $v)\n      "+n+".textContent = $v");break;case"html":p.third.push("$v=`"+k+"`;if ("+n+".innerHTML !== $v) "+n+".innerHTML = $v");break;case"value":if("checkbox"==t.type)t.hasAttribute("name")||t.hasAttribute("data-attr-name")?p.third.push(O+n+".checked = "+k+".indexOf("+n+".value) > -1"):p.third.push(O+n+".checked = "+k);else if("radio"==t.type)t.hasAttribute("name")||t.hasAttribute("data-attr-name")?p.third.push(O+n+".checked = "+k+" == "+n+".value"):p.third.push(O+n+".checked = "+k);else if("file"==t.type){let e=k.indexOf(":");0<=e&&(I=k.substring(e+1),k=k.substring(0,e))}else p.third.push(O+n+".value = "+k);let N="change";("TEXTAREA"===t.tagName||"range"===t.type)&&(N="input");const W="value";let S=A(W);c.push(r+".dataset.event_"+W+" = '"+S+"'");const T=y(t);let _=k;if(T.forContext){const{forIterator:e,contextVar:t,idxName:n}=T.forContext;_==t+".item"&&(_=e+"["+n+"]")}m.push({elemId:void 0===a?r:a,eventType:N,handlerEventCheck:"  if (!$isEventHandler(e.target, 'value', '"+S+"')) return;",handlerName:S,handlerCode:"file"===t.type?_+"=e.target.files[0];$importData(e.target, ()=>{$mainInstance.controller({})}, "+I+")":_+"=$typedReturn(e.target,"+_+");",forContext:"let [$ctxIdx,$ctxElems] = $indexesInForAncestors(e.target);"+T.contextString+";",deferredUpdate:"file"===t.type,refs:v});break;case"style1":if(e)break;case"style":p.third.push("$v=`"+k+"`;if ("+n+".getAttribute('style') !== $v) "+n+".setAttribute('style',  $v)");break;case"class1":if(e)break;case"class":const L=k.split(";");for(const e of L){let t,s;0<=e.indexOf(":")?(t=e.substring(0,e.indexOf(":")),s=e.substring(e.indexOf(":")+1)):t=s=e,p.third.push(n+".classList.toggle('"+t+"', "+s+")")}break;case"route1":if(e)break;case"route":{let[e,t]=C(k);k=e,k.startsWith("/")&&(b=[],k=k.substring(1));let n=k.split("/");0===n.length&&n.push(""),b=b.concat(n),k="reken.routing_path.length>="+b.length+"";for(let e=0;e<b.length;e++)if(b[e].startsWith("#")){let t=`let ${b[e].substring(1)} = reken.routing_path[${e}]`;0>p.third.indexOf(t)&&x.push(t)}else k+=`&&reken.routing_path[${e}] === '${b[e]}'`;t&&(k=t+":"+k)}if(t.dataset.if||t.dataset.if){t.$routeValue=k;continue}case"if1":if(e)break;case"if":{let[e,s]=C(k),[r,a]=C(t.$routeValue);r&&(k=`(${e})&&(${r})`),s||a?(s&&p.third.push(n+".classList.toggle('"+s+"', "+e+")"),a&&p.third.push(n+".classList.toggle('"+a+"', "+r+")")):(p.third.push("$v=("+k+"?'':'none');"),p.third.push("if ("+n+".style.display!==$v) "+n+".style.display=$v;")),t.dataset.for||void 0===t.dataset.if&&void 0===t.dataset.if1&&void 0===t.dataset.route||p.third.push("if ("+C(k)[0]+") {")}break;case"action1":if(e)break;case"action":{let e=A("click");c.push(r+".dataset.event_click = ("+r+".dataset.event_click??'')+'"+e+"'+':'"),m.push({elemId:void 0===a?r:a,eventType:"click",handlerEventCheck:"  if (!$isEventHandler(e.target, 'click', '"+e+"')) return;",handlerName:e,handlerCode:k,forContext:"let [$ctxIdx,$ctxElems] = $indexesInForAncestors(e.target);"+y(t).contextString+";",refs:v})}break;case"timer1":if(e)break;case"timer":{const e=k.split(":");let s,[i,d]=e;if(2<e.length&&(s=e.slice(2).join(":")),"undefined"==typeof i||"undefined"==typeof d||"undefined"==typeof s)console.error(`data-timer: [${k}] incorrect amount of arguments`);else{let e=A("timer");c.push(r+".dataset.event_timer = '"+e+"'"),m.push({elemId:void 0===a?r:a,eventType:"timer",handlerEventCheck:"",handlerName:e,handlerCode:s,forContext:"let [$ctxIdx,$ctxElems] = $indexesInForAncestors(e.target);"+y(t).contextString+";",refs:v}),p.third.push(`{const $l = ${n}`),p.third.push(`if ((${d}) && !$l.hasOwnProperty('timerID')) $l.timerID = setTimeout(()=>{this.${e}({'target':$l});delete $l.timerID;$mainInstance.controller({})}, ${i})`),p.third.push(`if (!(${d}) && $l.hasOwnProperty('timerID')) {clearTimeout($l.timerID); delete $l.timerID}}`)}}break;case"interval1":if(e)break;case"interval":{const e=k.split(":");let s,[i,d]=e;if(2<e.length&&(s=e.slice(2).join(":")),"undefined"==typeof i||"undefined"==typeof d||"undefined"==typeof s)console.error("data-interval: ["+k+"] incorrect amount of arguments");else{let e=A("interval");c.push(r+".dataset.event_interval = '"+e+"'"),m.push({elemId:void 0===a?r:a,eventType:"interval",handlerEventCheck:"",handlerName:e,handlerCode:s,forContext:"let [$ctxIdx,$ctxElems] = $indexesInForAncestors(e.target);"+y(t).contextString+";",refs:v}),p.third.push(`{const $l = ${n}`),p.third.push(`if ((${d}) && !$l.hasOwnProperty('intervalID')) $l.intervalID = setInterval(()=>{this.${e}({'target':$l});$mainInstance.controller({})}, ${i})`),p.third.push(`if (!(${d}) && $l.hasOwnProperty('intervalID')) {clearInterval($l.intervalID); delete $l.intervalID}}`)}break}case"for":void 0===a&&(a=n,v=[]),c.push(r+".dataset.leafCount="+t.children.length),(void 0!==t.dataset.if||void 0!==t.dataset.if1)&&0<t.children.length&&(p.third.push(O+"if ("+C(t.dataset.if)[0]+") {"),O="  "+O);let w=k.substring(0,k.indexOf(":")),j=k.substring(k.indexOf(":")+1),q=A("arr");isNaN(j)?(p.third.push(O+"$arrVar = "+j),p.third.push(O+"if (typeof $arrVar === 'undefined')$arrVar=0;"),p.third.push(O+"let "+q+" = (typeof ($arrVar) !== \"number\"?"+j+": new Array(parseInt($arrVar)))")):p.third.push(O+"let "+q+" = new Array(parseInt("+j+"))"),p.third.push(O+"$updateForChildren($classRegistry, $disableTimers, "+n+","+q+", "+t.children.length+")");let V=A("forElem"),R=A("counter");p.third.push(O+"for (let "+R+"=0;"+R+"<"+n+".children.length/"+t.children.length+";"+R+"++){"),p.third.push(O+"if ("+R+">="+q+".length) break;"),p.third.push(O+"let "+w+"= {index:"+R+", item:"+q+"["+R+"]}"),$+=(""==$?"":",")+w,p.third.push(O+"let "+V);let D=0;for(let e of t.children)p.third.push(O+V+" = "+n+".children["+R+"*"+t.children.length+"+"+D+"]"),h(!1,t.children[D],V,r+".children["+D+"]",a,d,c,p,m,g,b,x,$,v),D++;p.third.push(O+"}// End loop "+R),(void 0!==t.dataset.if||void 0!==t.dataset.if1)&&0<t.children.length&&(O=O.substring(2),p.third.push(O+"}"));break;case"calc1":if(e)break;case"calc":"SCRIPT"===t.tagName?p.second.push(t.textContent.trim()):p.third.push("elem = "+n+";"+k+";");break;case"component":a=void 0;let F=k;if(!s[k]||!s[k+"_static"]||"true"==t.dataset.hasSlot||""!=$){let e=[],n={first:[],second:[],third:[]},r=[];if(h(!0,t,"this.$root","this.$root",a,d,e,n,r,g,b,x,$,v),void 0===t.dataset.for){let s=0;for(let i of t.children){h(!1,i,"this.$root.children["+s+"]","this.$root.children["+s+"]",a,d,e,n,r,g,b,x,$,v),s++}void 0!==t.dataset.if&&n.third.push("}")}if(!s[k]){const[t,a]=f(k,k,e,n,r,x,"");g.push(...a),d.push(...t),d.push(`$classRegistry['${F}']=${("$main"==F?"":"$")+F.replace("-","_")}`),s[F]=!0}if("true"==t.dataset.hasSlot||""!=$){F=A(k);const[t,a]=f(F,k,e,n,r,x,$);d.push(...t),d.push(`$classRegistry['${F}']=${("$main"==F?"":"$")+F.replace("-","_")}`),s[F]=!0}else if("$main"!==k&&(F=k+"_static",!s[F])){const[t,a]=f(F,k,e,n,r,x,$);d.push(...t),d.push(`$classRegistry['${F}']=${("$main"==F?"":"$")+F.replace("-","_")}`),s[F]=!0}}else F=k+"_static";t.dataset.className=F,c.push(`    ${r}.$class = new ${("$main"==F?"":"$")+F.replace("-","_")}(${r})`),p.third.push("    {");let H=[];for(let e of Object.keys(t.dataset))if(e.startsWith("arg")||e.startsWith("bind")){let n=e.substring(3).toLowerCase();e.startsWith("bind")&&(n=e.substring(4).toLowerCase());let s=t.dataset[e],r=A("arg");/^[a-zA-Z_$][0-9a-zA-Z_$.\[\]\']*$/.test(s)?l(s)?p.third.push("      let "+r+" = '"+s+"'"):0<s.indexOf("'")?p.third.push("      let "+r+" = "+s+""):p.third.push("      let "+r+" = ((typeof "+s+"!== 'undefined' && !("+s+" instanceof Element))||typeof "+s+"=='function'?"+s+":'"+s+"')"):isNaN(s)?p.third.push("      let "+r+" = `"+s+"`"):p.third.push("      let "+r+" = "+s),H.push(`${n}:${r}`)}let M=H.join(",");0<H.length&&(M+=","),M+=$,p.third.push(`      ${n}.$class.controller({${M}})`),p.third.push("    }");break;case"rest1":if(e)break;case"rest":let P=k.substring(0,k.indexOf(":")),B=k.substring(k.indexOf(":")+1),U="",Y=B.indexOf(":");0<Y&&!B.startsWith("http")&&(U=(B.startsWith("[")?"":".")+B.substring(0,Y),B=B.substring(Y+1));let z="{}";t.dataset.restOptions&&(z=t.dataset.restOptions),t.dataset.restOptions1&&(z=t.dataset.restOptions1),p.third.push("    $processRestCall("+n+",`"+B+"`, "+z+", (js)=>{ if (this instanceof $main) "+P+"=js"+U+"; else this."+P+"=js"+U+";$mainInstance.controller({})})");break;default:if(E.startsWith("attr")||E.startsWith("attr1")&&!e){let e=u(E.substring(E.startsWith("attr1")?5:4));e.startsWith("data")&&(e=o(e)),i.includes(e.toLowerCase())?p.third.push("if ("+k+"){"+n+".setAttribute('"+e+"', `"+k+"`)}else{"+n+".removeAttribute('"+e+"')}"):p.third.push("if ("+n+".getAttribute('"+e+"') !== `"+k+"`) "+n+".setAttribute('"+e+"', `"+k+"`)")}else if(E.startsWith("on")||E.startsWith("on1")&&!e){let e=E.substring(E.startsWith("on1")?3:2).toLowerCase(),n=k,s=A(e);c.push(r+".dataset.event_"+e+" = '"+s+"'"),m.push({elemId:void 0===a?r:a,eventType:e,handlerEventCheck:"  if (!$isEventHandler(e.target, '"+e+"', '"+s+"')) return;",handlerName:s,handlerCode:n,forContext:"let [$ctxIdx,$ctxElems] = $indexesInForAncestors(e.target);"+y(t).contextString+";",refs:v})}}}}if(!t.dataset.component&&!t.dataset.for){let e=0;for(let s of t.children)h(!1,s,n+".children["+e+"]",r+".children["+e+"]",a,d,c,p,m,g,b,x,$,v),e++;(void 0!==t.dataset.if||void 0!==t.dataset.route)&&p.third.push("} else {$disableTimers("+n+")}")}else null==t.dataset.if1||e||p.third.push("} else {$disableTimers("+n+")}")},o=e=>{let t="";for(const n of e)n.match(/[a-z]/i)&&n===n.toUpperCase()&&0<t.length&&(t+="-"),t+=n.toLowerCase();return t},u=e=>e.charAt(0).toLowerCase()+e.slice(1),c=e=>{if("TEMPLATE"!=e.tagName&&"component"in e.dataset){let t=p(e.dataset.component);if(null!=t){for(let t of e.children)c(t);let n=t.querySelector("slot");if(null!=n&&0<e.childNodes.length){t.dataset.hasSlot="true";let s=n;for(let t,r=e.childNodes.length-1;0<=r;r--)t=e.childNodes[r],n.parentElement.insertBefore(t,s),s=t;n.parentElement.removeChild(n)}let s=["data-ref","data-action","data-style","data-class","data-if","data-timer","data-interval","data-route","data-rest","data-rest-options","data-calc"];for(let n of e.getAttributeNames()){if(0<=s.indexOf(n)){t.setAttribute(n+"1",e.getAttribute(n));continue}if(n.startsWith("data-on")){t.setAttribute("data-on1"+n.substring(7),e.getAttribute(n));continue}if(n.startsWith("data-attr")){t.setAttribute("data-attr1"+n.substring(9),e.getAttribute(n));continue}null==t.getAttribute(n)?null!=e.getAttribute(n)&&t.setAttribute(n,e.getAttribute(n)):((n.startsWith("data-arg")||n.startsWith("data-bind"))&&t.setAttribute(n,e.getAttribute(n)),"class"==n&&t.classList.add(e.getAttribute("class")))}e.parentElement.replaceChild(t,e)}}else for(let t of e.children)c(t)},p=e=>{let n=t[e];if(n===void 0){let s=document.querySelector(`template[data-component='${e}']`);if(null==s||null==s.content||0==s.content.children.length)return console.error(`Component ${e}: no component definition found`),null;for(let e of s.content.children)if("STYLE"!==e.tagName&&"SCRIPT"!==e.tagName){n=e;break}c(n),n.setAttribute("data-component",e),t[e]=n}let s=n.cloneNode(!0);return s},f=(e,t,n,s,r,a,i)=>{let d=document.querySelector("template[data-component='"+t+"']");const l=e==t||"$main"==e;let h=[];const[o,u]=m(d);o.push("$root");const c=b(d,"arg"),p=b(d,"bind"),f=p.map(e=>e.substring(0,e.indexOf("="))),y=[...c,...p],v=y.map(e=>e.substring(0,e.indexOf("="))),[C,E]=g(d,o,y);if(h.push("//=============================================================================="),h.push(`class ${("$main"==e?"":"$")+e.replace("-","_")} extends ${l?"$base":"$"+t.replace("-","_")} {`),l&&"$main"!=e){h.push(...E),h.push("  constructor($root) {"),h.push("  super($root)"),h.push("    this.$root = $root;"),h.push(...u);for(let e of o.filter(e=>"$root"!=e))h.push(`    this.${e} = ${e}`);return h.push("  }"),h.push("  }"),[h,x(d)]}h.push("  constructor($root) {"),h.push("  super($root)"),h.push("    this.$root = $root;"),h.push(...n);for(let d of r)h.push("    "+d.elemId+".addEventListener('"+d.eventType+"', event => this."+d.handlerName+"(event))");h.push("  }"),h.push("  static createInstance(elem) {"),h.push(`    return new ${("$main"==e?"":"$")+e.replace("-","_")}(elem);`),h.push("  }");let A=y.join(",");0<y.length&&(A+=","),A+=i,h.push(`  controller({${A}}) {`);for(let d of o)h.push(`    let ${d} = this.${d}`);for(let d of C)h.push(d);if("$main"===e)for(let e of a)h.push("    "+e);h.push(...$(d)),h.push(...s.first),0<s.third.length+s.second.length&&(h.push("    let $v, elem, $arrVar"),h.push(...s.second),h.push(...s.third));for(let d of y){let e=d.substring(0,d.indexOf("="));h.push("    this."+e+" = "+e)}for(let d of o.filter(e=>"$root"!=e))h.push(`    this.${d} = ${d}`);h.push("  }");for(let d of r){h.push("  "+d.handlerName+"(e) {"),""!==(d.handlerEventCheck??"").trim()&&h.push("  "+d.handlerEventCheck),h.push("    let $elem");for(let e of o)h.push(`    let ${e} = this.${e}`);for(let e of v)h.push("    let "+e+" = this."+e);for(let e of a)h.push("    "+e);for(let e of C)h.push(e);h.push("    "+d.forContext),d.refs&&d.refs.forEach(e=>{const[t,n]=e;h.push(`    ${t} = $elem${""===n?"":"."}${n}`)}),h.push("    "+d.handlerCode);for(let e of f)h.push("    if ("+e+"!==this."+e+") $root.dispatchEvent(new CustomEvent('"+e+"', {detail:{'value':"+e+"},bubbles: true}))");for(let e of o.filter(e=>"$root"!=e))h.push(`    this.${e} = ${e}`);d.deferredUpdate||"timer"===d.eventType||"interval"===d.eventType||h.push("    $mainInstance.controller({})"),h.push("  }")}return h.push("}"),[h,x(d)]},m=e=>{let t=[],n=[];if(e){let s=e.content.querySelector("script");if(null!=s&&!s.hasAttribute("data-calc")&&0<s.childNodes.length){let e=s.textContent.split(/\r?\n/);for(let s of e){if(s=s.trim(),s.startsWith("function"))break;if(""==s||!(s.startsWith("let")||s.startsWith("const")))continue;n.push("    "+s);let e=s.split(/=? /),r=e[1];t.push(r)}}}return[t,n]},g=(e,t,n)=>{let s=["    let dispatch = (type, content)=>this.dispatch(type, content)"],r=[],a=!0;if(e){let i=e.content.querySelector("script");if(null!=i&&!i.hasAttribute("data-calc")&&0<i.childNodes.length){let e=i.textContent.split(/\r?\n/);for(let i of e){if(i=i.trim(),i.startsWith("function")){a=!1,i=i.substring(8);let e=i.substring(0,i.indexOf("(")).trim(),d=i.substring(e.length+1,i.indexOf(")")+1).trim();r.push("  "+i.trim());for(let e of t)r.push(`    let ${e} = this.${e}`);for(let e of s)r.push("  "+e);for(let e of n){let t=e.substring(0,e.indexOf("="));r.push("  let "+t+" = this."+t)}s.push(`let ${e} = ${d}=>this.${e}${d}`);continue}a||r.push("    "+i)}}}return[s,r]},b=(e,t,n=!0,s="=")=>{let r=[];if(e)for(let a of Object.keys(e.dataset))if(a.startsWith(t)){let i=a.substring(t.length).toLowerCase();if(n){let t=e.dataset[a];i+=""==t?`${s}undefined`:`${s}${isNaN(t)?"'"+t+"'":t}`}r.push(i)}return r},x=e=>{if(e&&e.content.querySelector("style")){let t=e.content.querySelector("style");if(null!=t&&t.textContent){let n=e.dataset.component,s=t.textContent.split(/\r?\n/);for(let e=0;e<s.length;e++)if(0<s[e].indexOf("{")&&0>s[e].indexOf("@")){let t=s[e].split(","),r=[];for(let e of t){let t=e.indexOf(":host");0<=t&&(e=e.substring(t+5));let s=e.trim();0>".#[:".indexOf(s[0])&&(s=" "+s),e=`[data-component=${n}]`+s,r.push(e)}s[e]=r.join(",")}return s}}return[]},$=e=>{if(e&&e.content.querySelector("script[data-calc]")){let t=e.content.querySelector("script[data-calc]");if(null!=t&&t.textContent){let e=t.textContent.split(/\r?\n/);return e}}return[]},y=(e,t)=>{"undefined"==typeof t&&(t={},t.idx=0,t.contextString="");let n=e.parentElement;if(null!=n&&(y(n,t),"undefined"!=typeof n.dataset.for)){t.forContext=v(n);const e="$ctxIdx["+t.idx+"]",s="$ctxElems["+t.idx+"]";t.idx+=1,t.forContext.idxName=e;const{forIterator:r,contextVar:a}=t.forContext;let i="let "+a+"= {index:"+e+"};";return i+="if (typeof ("+r+") !== 'number' && typeof ("+r+") !== 'undefined')"+a+"['item'] = "+r+"["+e+"];",t.contextString+=i,t.contextString+="$elem = "+s+";",t}return t},v=e=>{let t=e.dataset.for,n=t.substring(0,t.indexOf(":")),s=t.substring(t.indexOf(":")+1);return{forIterator:s,contextVar:n}},C=e=>{if("undefined"==typeof e)return[null,null];let t=null,n=e;return 0<=e.indexOf(":")&&(t=e.substring(0,e.indexOf(":")),n=e.substring(e.indexOf(":")+1)),[n,t]};let E=0;const A=e=>`$${e??""}`+E++,k=(e,t)=>{const n=t.dataset.component;return e.querySelectorAll(n).forEach(e=>{let s="DIV";for(const n of t.content.children)if("SCRIPT"!=n.tagName&&"STYLE"!==n.tagName){s=n.tagName;break}const r=document.createElement(s);for(let n,s=e.attributes.length-1;0<=s;--s)if(n=e.attributes[s],t.hasAttribute("data-arg-"+n.name)){r.setAttribute("data-arg-"+n.name,e.getAttribute(n.name));continue}else if(t.hasAttribute("data-bind-"+n.name)){r.setAttribute("data-bind-"+n.name,e.getAttribute(n.name));continue}else{if(n.name.startsWith("data-attr")){const s=n.name.substring(10);if(t.hasAttribute("data-arg-"+s)){r.setAttribute("data-arg-"+s,e.getAttribute(n.name));continue}}r.attributes.setNamedItem(e.attributes[s].cloneNode())}let a;for(let t,n=e.childNodes.length-1;0<=n;n--)t=e.childNodes[n],0==r.childNodes.length?r.appendChild(t):r.insertBefore(t,a),a=t;r.setAttribute("data-component",n),e.parentElement.replaceChild(r,e)}),n},I=()=>{let e=[];document.querySelectorAll("template[data-component]").forEach(t=>{e.push(k(document,t)),document.querySelectorAll("template[data-component]").forEach(e=>{k(e.content,t)})}),O(e),e.sort((e,t)=>t.length-e.length)},O=e=>{document.querySelectorAll("head > style").forEach(t=>{const n=t.textContent.split("\n"),s=[];for(let r of n){if(0<=r.indexOf("{"))for(const t of e)for(let e=0;0<=e;)e=r.indexOf(t,e),0<=e&&((0==e||0<="\t ,>+~]".indexOf(r[e-1]))&&0<="\t ,.:{>+~[".indexOf(r[e+t.length])?(r=r.substring(0,e)+"[data-component="+t+"]"+r.substring(e+t.length),e+=("[data-component="+t+"]").length):e++);s.push(r)}t.textContent=s.join("\n")})},N=(e,t)=>{const n=[];return e.querySelectorAll("div[data-include]").forEach(async e=>{let s=e.dataset.include;if(s){t&&!s.startsWith("/")&&(s=t+"/"+s);const r=fetch(s).then(e=>{if(e.ok)return e.text();throw Error(`${e.status} - ${e.statusText}`)}).then(n=>{e.innerHTML=n;const r=s.split("/");return 1<r.length&&(r.pop(),t=r.join("/")),N(e,t)}).catch(()=>{e.textContent=`File ${s} not found.`});n.push(r)}}),Promise.allSettled(n)},W=(e,t,n,s)=>{if(n&&"undefined"!=typeof n.fetch){if(!1===n.fetch)return;n.fetch=!1}else{if(typeof e.dataset.url!==void 0&&e.dataset.url===t)return;e.dataset.url=t}e.classList.add("reken-rest-busy"),e.classList.remove("reken-rest-error","reken-rest-done");let r=!1;fetch(t,n).then(e=>{if(!e.ok&&304===!e.status)throw new Error(`Network response was not ok, code ${e.status} - ${e.statusText}`);if(304===e.status)return void(r=!0);if(n.response=e,n.transformer){let t=Promise.resolve(e.text());return t.then(e=>n.transformer(e,n))}return e.json()}).then(t=>{r||s(t),e.classList.add("reken-rest-done")}).catch(t=>{throw e.classList.add("reken-rest-error"),t}).finally(()=>{e.classList.remove("reken-rest-busy")})},S=(e,t)=>{switch(e.type){case"checkbox":return e.getAttribute("name")?(e.checked&&0>t.indexOf(e.value)&&t.push(e.value),!e.checked&&-1<t.indexOf(e.value)&&t.splice(t.indexOf(e.value),1),t):e.checked;case"radio":return e.getAttribute("name")?e.value:e.checked;case"number":case"range":return e.valueAsNumber;case"file":return e.files[0];default:return e.value}},T=(t,n,s)=>{let r=t.files[0],a=new FileReader;a.onload=function(a){let e=a.target.result;t.files[0].data=s?s(e,r):JSON.parse(e),n()},a.readAsText(r)},_=(e,t=[],n=[])=>{var s=Math.floor;let r=e.parentElement;return null!=r&&([t,n]=_(r,t),"undefined"!=typeof r.dataset.for&&(n.push(e),t.push(s(w(r.children,e)/r.dataset.leafCount)))),[t,n]},L=(e,t,n)=>{const s="event_"+t;return e.dataset[s]&&0<=e.dataset[s].indexOf(n)?!(e.hasAttribute("disabled")||e.hasAttribute("readonly")):null!=e.parentElement&&L(e.parentElement,t,n)},w=(e,t)=>{let n=0;for(let s of e){if(s===t)return n;n++}return-1},j=(e,t,n,s,r)=>{let a=n.children,d=a.length/r;if(0<d||n.childrenStore){if(!n.childrenStore){n.childrenStore=[];let e=n.childrenStore;for(let t=0;t<r;t++)e[t]=a[t],e[t].removeAttribute("id"),e[t].querySelectorAll("[id]").forEach(e=>{e.removeAttribute("id")})}for(let t=0;t<s.length;t++){let s;for(let i,h=0;h<r;h++)i=t*r+h,t<d?s=a[i]:(s=n.childrenStore[h].cloneNode(!0),V(e,s),n.appendChild(s))}let h=!0;const o=[];for(let e=s.length;e<d;e++)for(let n,s=0;s<r;s++)if(n=e*r+s,a[n])o.push(a[n]),h&&0==t(a[n])&&(h=!1);else continue;o.forEach(e=>{n.removeChild(e)})}},q=e=>{let t=0;e.hasOwnProperty("intervalID")&&(clearInterval(e.intervalID),delete e.intervalID,t++),e.hasOwnProperty("timerID")&&(clearInterval(e.timerID),delete e.timerID,t++);let n=e.children;for(let s=0;s<n.length;s++)t+=q(n[s]);return t},V=(e,t)=>{if(void 0!==t.dataset.component)return void(void 0===t.$class&&(t.$class=e[t.dataset.className].createInstance(t)));for(let n of t.children)V(e,n)},R=()=>{function t(e){let t=[];if(2<e.length){const n=e.substring(2);t=n.split("/")}return t.push(""),t}if(e.routing_path=t(window.location.hash),window.addEventListener("hashchange",()=>{e.routing_path=t(window.location.hash),document.body.parentElement.$class.controller({})}),!r()){let t=[],i=["template {display:none !important;}"];document.body.parentElement.setAttribute("data-component","$main"),t.push("class $base { dispatch(type, content){this.$root.dispatchEvent(new CustomEvent(type, {detail:content}))}} ");if(h(!1,document.body.parentElement,"_r","_r",void 0,t,[],{first:[],second:[],third:[]},[],i,[],[],"",[]),0<i.length){const e=document.querySelector("head");null==e&&(e=document.createElement("head"),document.body.parentElement.insertBefore(e,document.body));const t=document.createElement("style");t.textContent=i.join("\n"),e.appendChild(t)}t.push("let $mainInstance = $main.createInstance(document.body.parentElement)"),t.push("document.body.parentElement.$class = $mainInstance"),t.push("document.body.dispatchEvent(new CustomEvent('rekeninitialized', {}))"),t.push("$mainInstance.controller({})"),t.push("document.body.dispatchEvent(new CustomEvent('rekenready', {}))");let d=t.join("\n"),l=new Function("reken","$classRegistry","$updateForChildren","$disableTimers","$processRestCall","$indexesInForAncestors","$isEventHandler","$typedReturn","$importData",d);if(a()||l(e,n,j,q,W,_,L,S,T),a()&&!r()){var s=document.createElement("a");let e=document.body.parentElement.innerHTML.split("\n"),t=[];for(let n of e)0<=n.indexOf("reken.js")&&(n=""),t.push(n);e=t,s.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent("<html>"+e.join("\n")+"<script>var rkn_server_generated = true</script><script src=\"../src/reken.js\"></script><style>\n"+i.join("\n")+"</style>\n<script>\n"+d+"</script>\n</html>")),console.log(i.join("\n")),console.log(d),s.setAttribute("download",document.title+".txt"),s.textContent="Download Reken page controller",document.body.appendChild(s)}}};e.force_calculate=()=>{document.body.parentElement.$class.controller({})},e.forceCalculate=()=>{console.warn("reken.forceCalculate is deprecated; please use reken.force_calculate. [as of 0.9.2]"),e.force_calculate()},globalThis.reken=e,r()||N(document.body.parentElement).then(()=>{r()||(I(),c(document.body.parentElement)),R()})}