"use strict";class $RekenBase{static classRegistry={};dispatch(e,t){this.$root.dispatchEvent(new CustomEvent(e,{detail:t}))}static processRestCall(e,t,n,s){if(n&&"undefined"!=typeof n.fetch){if(!1===n.fetch)return;n.fetch=!1}else{if(typeof e.dataset.url!==void 0&&e.dataset.url===t)return;e.dataset.url=t}n.url=t,e.classList.add("reken-rest-busy"),n.reken_rest_status="reken-rest-busy",e.classList.remove("reken-rest-error","reken-rest-done");let r=!1,a=null;fetch(t,n).then(e=>{if(n.response=e,!e.ok)throw new Error(`Network response was not ok, code ${e.status} - ${e.statusText}`);if(400<=e.status&&600>e.status)throw new Error(`Http error: code ${e.status} - ${e.statusText}`);if(n.response=e,n.transformer){let t=Promise.resolve(e.text());return t.then(e=>n.transformer(e,n))}try{return e.json()}catch(t){r=!0}}).then(t=>{if("undefined"!=typeof n.reviver){const e=t=>{Array.isArray(t)?t.forEach(t=>{e(t)}):"object"==typeof t&&Object.keys(t).forEach(e=>{t[e]=n.reviver(e,t[e])})};e(t)}a=t,n.reken_rest_status="reken-rest-done",e.classList.add("reken-rest-done"),e.classList.remove("reken-rest-busy"),n.callback&&"function"==typeof n.callback&&n.callback(n,a),s(t,r)}).catch(()=>{e.classList.add("reken-rest-error"),n.reken_rest_status="reken-rest-error",e.classList.remove("reken-rest-busy"),n.callback&&"function"==typeof n.callback&&n.callback(n,a),reken.force_calculate()})}static typedReturn(e,t){switch(e.type){case"checkbox":return e.getAttribute("name")?(e.checked&&0>t.indexOf(e.value)&&t.push(e.value),!e.checked&&-1<t.indexOf(e.value)&&t.splice(t.indexOf(e.value),1),t):e.checked;case"radio":return e.getAttribute("name")?e.value:e.checked;case"number":case"range":return e.valueAsNumber;case"file":return e.files[0];default:return e.value}}static updateSelectModel(e,t){for(let n=0,s=e.options.length;n<s;n++){const s=e.options[n],r=s.value??s.text,a=t.indexOf(r);s.selected?0>a&&t.push(r):0<=a&&t.splice(a,a+1)}}static updateSelectElement(e,t){for(let n=0,s=e.options.length;n<s;n++){const s=e.options[n];s.selected=0<=t.indexOf(s.value??s.text)}}static importData(t,n,s){let r=t.files[0],a=new FileReader;a.onload=function(a){let e=a.target.result;t.files[0].data=s?s(e,r):JSON.parse(e),n()},a.readAsText(r)}static indexesInForAncestors(e,t=[],n=[]){var s=Math.floor;let r=e.parentElement;return null!=r&&([t,n]=$RekenBase.indexesInForAncestors(r,t),"undefined"!=typeof r.dataset.for&&(n.push(e),t.push(s($RekenBase.indexOf(r.children,e)/r.dataset.leafCount)))),[t,n]}static isEventHandler(e,t,n){const s="event_"+t;return e.dataset[s]&&0<=e.dataset[s].indexOf(n)?!(e.hasAttribute("disabled")||e.hasAttribute("readonly")):null!=e.parentElement&&$RekenBase.isEventHandler(e.parentElement,t,n)}static indexOf(e,t){let n=0;for(let s of e){if(s===t)return n;n++}return-1}static updateForChildren=(e,t,n,s,r)=>{var a=Math.min;let d=t.children,o=d.length/s;if(r=a(n.length,r),0<o||t.childrenStore){if(!t.childrenStore){t.childrenStore=[];let e=t.childrenStore;for(let n=0;n<s;n++)e[n]=d[n],e[n].removeAttribute("id"),e[n].querySelectorAll("[id]").forEach(e=>{e.removeAttribute("id")}),(e[n].getAttribute("data-component")||0<e[n].querySelectorAll("[data-component]").length)&&(e[n].$hasComponents=!0),(e[n].getAttribute("data-timer")||0<e[n].querySelectorAll("[data-timer]").length)&&(e[n].$hasTimers=!0,t.$hasTimers=!0),(e[n].getAttribute("data-interval")||0<e[n].querySelectorAll("[data-interval]").length)&&(e[n].$hasTimers=!0,t.$hasTimers=!0)}for(let n=0;n<r;n++){let r;for(let a,i=0;i<s;i++)a=n*s+i,n<o?r=d[a]:(r=t.childrenStore[i].cloneNode(!0),t.childrenStore[i].$hasComponents&&$RekenBase.initComponentElement(e,r),t.appendChild(r))}if(0==r&&!t.$hasTimers)return void(t.innerText="");const n=[];for(let e=r;e<o;e++)for(let r,a=0;a<s;a++){r=e*s+a;const i=d[r];i&&(n.push(i),t.childrenStore[a].$hasTimers&&$RekenBase.disableTimers(i))}n.forEach(e=>{t.removeChild(e)})}};static disableTimers(e){let t=0;e.hasOwnProperty("intervalID")&&(clearInterval(e.intervalID),delete e.intervalID,t++),e.hasOwnProperty("timerID")&&(clearTimeout(e.timerID),delete e.timerID,t++);let n=e.children;for(let s=0;s<n.length;s++)t+=$RekenBase.disableTimers(n[s]);return t}static initComponentElement(e,t){if(void 0!==t.dataset.component)return void(void 0===t.$class&&(t.$class=e[t.dataset.className].createInstance(t)));for(let n of t.children)$RekenBase.initComponentElement(e,n)}}{const e={};e.version="0.10.2.2",e.routing_path;let t={},n={};const s=()=>"undefined"!=typeof rkn_server_generated&&rkn_server_generated,r=()=>"undefined"!=typeof rkn_generate_code&&rkn_generate_code;let a=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","controls","checked","default","defer","disabled","formnovalidate","hidden","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected","truespeed"];const i=["break","case","catch","class","const","continue","debugger","default","delete","do","else","export","extends","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","try","typeof","var","void","while","with"],d=e=>0<=i.indexOf(e),l=(e,t,s,r,u,c,f,m,g,b,x,y,C,O,S)=>{if("TEMPLATE"==t.tagName)return;let N=Object.keys(t.dataset).sort();if(N.indexOf("data-component")){let e=!1;for(let n of N){if(n.startsWith("bind")){let s=A(t.dataset[n],S);t.setAttribute("data-on1-bind_"+n.substring(4).toLowerCase(),s+"=e.detail.value"),e=!0}n.startsWith("arg")&&A(t.dataset[n],S)}e&&(N=Object.keys(t.dataset).sort())}if(0<N.length){if(e){let e=["component"];for(let t of N)(0<t.startsWith("arg")||0<t.startsWith("bind"))&&e.push(t);for(let t of e){let e=N.indexOf(t);0<=e&&N.splice(e,1)}}else if(0<=N.indexOf("component")){let e=["component"];for(let t of N)(t.startsWith("arg")||t.startsWith("bind")||t.startsWith("action1")||t.startsWith("style1")||t.startsWith("class1")||t.startsWith("if1")||t.startsWith("on1")||t.startsWith("attr1")||t.startsWith("timer1")||t.startsWith("interval1")||t.startsWith("route1")||t.startsWith("rest1")||t.startsWith("rest-options1")||t.startsWith("calc1")||t.startsWith("ref1")||t.startsWith("var1"))&&e.push(t);N=e}let i=[],I=["route","ref1","style1","if1","action1","on1","attr1","class1","var1","ref","component","style","if","for","calc","attrName","attrMin","attrMax","attrValue","value","var"];for(let e of I){let t=N.indexOf(e);0<=t&&(i.push(e),N.splice(t,1))}for(let e of N)i.push(e);let T="    ";for(let N of i){let I=t.dataset[N],L="";switch(""!=t.id&&"this.$root"!=s&&s===r&&(s="document.getElementById('"+t.id+"')"),N){case"ref1":if(e)break;case"ref":"undefined"==typeof u?(I=A(I,S),m.first.push(T+I+" = "+s+";")):(I=A(I,S),O.push([I,s.split(".").slice(1).join(".")]),m.third.push(T+I+" = "+s+";"));break;case"text":m.third.push(T+"$v = `"+I+"`;\n    if ("+s+".textContent !== $v)\n      "+s+".textContent = $v");break;case"html":m.third.push("$v=`"+I+"`;if ("+s+".innerHTML !== $v) "+s+".innerHTML = $v");break;case"value":if(I=A(I,S),"checkbox"==t.type)t.hasAttribute("name")||t.hasAttribute("data-attr-name")?m.third.push(T+s+".checked = "+I+".indexOf("+s+".value) > -1"):m.third.push(T+s+".checked = "+I);else if("radio"==t.type)t.hasAttribute("name")||t.hasAttribute("data-attr-name")?m.third.push(T+s+".checked = "+I+" == "+s+".value"):m.third.push(T+s+".checked = "+I);else if("file"==t.type){let e=I.indexOf(":");0<=e&&(L=I.substring(e+1),I=I.substring(0,e))}else"SELECT"===t.tagName&&t.hasAttribute("multiple")?m.third.push(T+"$RekenBase.updateSelectElement("+s+","+I+");"):m.third.push(T+s+".value = "+I);let w="change";("TEXTAREA"===t.tagName||"range"===t.type)&&(w="input");const _="value";let R=E(_);f.push(r+".dataset.event_"+_+" = '"+R+"'");const B=v(t);let j=I;if(B.forContext){const{forIterator:e,contextVar:t,idxName:n}=B.forContext;j==t+".item"&&(j=e+"["+n+"]")}g.push({elemId:void 0===u?r:u,eventType:w,handlerEventCheck:"  if (!$RekenBase.isEventHandler(e.target, 'value', '"+R+"')) return;",handlerName:R,handlerCode:"file"===t.type?j+"=e.target.files[0];$RekenBase.importData(e.target, ()=>{$mainInstance.controller({})}, "+L+")":"SELECT"===t.tagName&&t.hasAttribute("multiple")?"$RekenBase.updateSelectModel(e.target,"+I+")":j+"=$RekenBase.typedReturn(e.target,"+j+");",forContext:"let [$ctxIdx,$ctxElems] = $RekenBase.indexesInForAncestors(e.target);"+B.contextString+";",deferredUpdate:"file"===t.type,refs:O});break;case"style1":if(e)break;case"style":m.third.push("$v=`"+I+"`;if ("+s+".getAttribute('style') !== $v) "+s+".setAttribute('style',  $v)");break;case"class1":if(e)break;case"class":const q=I.split(";");for(const e of q){let t,n;0<=e.indexOf(":")?(t=e.substring(0,e.indexOf(":")),n=e.substring(e.indexOf(":")+1)):t=n=e;const r=A(n,S);n===t&&(t=r),n=r,m.third.push(s+".classList.toggle('"+t+"', "+n+")")}break;case"route1":if(e)break;case"route":{let[e,t]=$(I);I=e,I.startsWith("/")&&(x=[],I=I.substring(1));let n=I.split("/");0===n.length&&n.push(""),x=x.concat(n),I="reken.routing_path.length>="+x.length+"";for(let e=0;e<x.length;e++)if(x[e].startsWith("#")){let t=`let ${x[e].substring(1)} = reken.routing_path[${e}]`;0>m.third.indexOf(t)&&y.push(t)}else I+=`&&reken.routing_path[${e}] === '${x[e]}'`;t&&(I=t+":"+I)}if(t.dataset.if||t.dataset.if){t.$routeValue=I;continue}case"if1":if(e)break;case"if":{let[e,n]=$(I);e=A(e,S);let[r,a]=$(t.$routeValue);I=r?`(${e})&&(${r})`:e,n||a?(n&&m.third.push(s+".classList.toggle('"+n+"', "+e+")"),a&&m.third.push(s+".classList.toggle('"+a+"', "+r+")")):(m.third.push("if ("+s+".style.display != 'none')"+s+".$save_display = "+s+".style.display"),m.third.push("$v=("+I+"?"+s+".$save_display??'block':'none');"),m.third.push("if ("+s+".style.display!==$v) "+s+".style.display=$v;")),t.dataset.for||void 0===t.dataset.if&&void 0===t.dataset.if1&&void 0===t.dataset.route||m.third.push("if ("+$(I)[0]+") {")}break;case"action1":if(e)break;case"action":{let e=E("click");f.push(r+".dataset.event_click = ("+r+".dataset.event_click??'')+'"+e+"'+':'");const n=I.split(":");let s=I,a=null;1<n.length&&(a=n[0],a=A(a,S,"this."),s=n.slice(1).join(":")),g.push({elemId:void 0===u?r:u,eventType:"click",handlerEventCheck:"  if (!("+(a?"("+a+")&&":"")+"$RekenBase.isEventHandler(e.target, 'click', '"+e+"'))) return;",handlerName:e,handlerCode:s,forContext:"let [$ctxIdx,$ctxElems] = $RekenBase.indexesInForAncestors(e.target);"+v(t).contextString+";",refs:O})}break;case"timer1":if(e)break;case"timer":{const e=I.split(":");let n,[a,i]=e;if(2<e.length&&(n=e.slice(2).join(":")),"undefined"==typeof a||"undefined"==typeof i||"undefined"==typeof n)console.error(`data-timer: [${I}] incorrect amount of arguments`);else{a=A(a,S),i=A(i,S);let e=E("timer");f.push(r+".dataset.event_timer = '"+e+"'"),g.push({elemId:void 0===u?r:u,eventType:"timer",handlerEventCheck:"",handlerName:e,handlerCode:n,forContext:"let [$ctxIdx,$ctxElems] = $RekenBase.indexesInForAncestors(e.target);"+v(t).contextString+";",refs:O}),m.third.push(`{const $l = ${s}`),m.third.push(`if ((${i}) && !$l.hasOwnProperty('timerID')) $l.timerID = setTimeout(()=>{this.${e}({'target':$l});delete $l.timerID;$mainInstance.controller({})}, ${a})`),m.third.push(`if (!(${i}) && $l.hasOwnProperty('timerID')) {clearTimeout($l.timerID); delete $l.timerID}}`)}}break;case"interval1":if(e)break;case"interval":{const e=I.split(":");let n,[a,i]=e;if(2<e.length&&(n=e.slice(2).join(":")),"undefined"==typeof a||"undefined"==typeof i||"undefined"==typeof n)console.error("data-interval: ["+I+"] incorrect amount of arguments");else{a=A(a,S),i=A(i,S);let e=E("interval");f.push(r+".dataset.event_interval = '"+e+"'"),g.push({elemId:void 0===u?r:u,eventType:"interval",handlerEventCheck:"",handlerName:e,handlerCode:n,forContext:"let [$ctxIdx,$ctxElems] = $RekenBase.indexesInForAncestors(e.target);"+v(t).contextString+";",refs:O}),m.third.push(`{const $l = ${s}`),m.third.push(`if ((${i}) && !$l.hasOwnProperty('intervalID')) $l.intervalID = setInterval(()=>{this.${e}({'target':$l});$mainInstance.controller({})}, ${a})`),m.third.push(`if (!(${i}) && $l.hasOwnProperty('intervalID')) {clearInterval($l.intervalID); delete $l.intervalID}}`)}break}case"for":void 0===u&&(u=s,O=[]),f.push(r+".dataset.leafCount="+t.children.length),(void 0!==t.dataset.if||void 0!==t.dataset.if1)&&0<t.children.length&&(m.third.push(T+"if ("+$(t.dataset.if)[0]+") {"),T="  "+T);let M=I.split(":"),D=M[0],V=M[1],F=3<M.length?M[2]:void 0,H=3<M.length?M[3]:M[2],P=E("arr");isNaN(V)?(V=A(V,S),m.third.push(T+"$arrVar = "+V),m.third.push(T+"if (typeof $arrVar === 'undefined')$arrVar=0;"),m.third.push(T+"let "+P+" = (typeof ($arrVar) !== \"number\"?"+V+": new Array(parseInt($arrVar)))")):m.third.push(T+"let "+P+" = new Array(parseInt("+V+"))");const G=E("forStop");m.third.push(T+"const "+G+" = Math.min("+P+".length,"+(H??P+".length")+") - "+(F??"0")),m.third.push(T+"$RekenBase.updateForChildren($RekenBase.classRegistry, "+s+","+P+", "+t.children.length+", "+G+")");let U=E("forElem"),Y=E("counter");const z=E("forRoot");m.third.push(T+"const "+z+" = "+s);const X=E("rootItemCount");m.third.push(T+"const "+X+" = "+z+".children.length/"+t.children.length),m.third.push(T+"for (let "+Y+"=0;"+Y+"<"+G+";"+Y+"++){"),m.third.push(T+"let "+D+"= {index:"+Y+", item:"+P+"["+Y+"+"+(F??"0")+"],itemIndex:"+Y+"+"+(F??"0")+"}"),0>C.split(",").indexOf(D)&&(C+=(""==C?"":",")+D),m.third.push(T+"let "+U);let J=0;for(let e of t.children)m.third.push(T+U+" = "+s+W(Y+"*"+t.children.length+"+"+J)),l(!1,t.children[J],U,r+W(J),u,c,f,m,g,b,x,y,C,O,S),J++;m.third.push(T+"}// End loop "+Y),(void 0!==t.dataset.if||void 0!==t.dataset.if1)&&0<t.children.length&&(T=T.substring(2),m.third.push(T+"}"));break;case"calc1":if(e)break;case"calc":"SCRIPT"===t.tagName?m.second.push(T+t.textContent.trim()):m.third.push("elem = "+s+";"+I+";");break;case"var1":if(e)break;case"var":let i=I.trim().split(";"),K=[];for(let e of i){let t=e.trim();""!==t&&(t.startsWith("let ")||t.startsWith("const ")||t.startsWith("var ")||(t="let "+t),K.push(t))}S.push(...K);break;case"component":u=void 0;let Q=I,Z=[],ee={first:[],second:[],third:[]},te=[];if(S=[],l(!0,t,"this.$root","this.$root",u,c,Z,ee,te,b,x,y,C,O,S),void 0===t.dataset.for){let e=0;for(let n of t.children){l(!1,n,"this.$root"+W(e),"this.$root"+W(e),u,c,Z,ee,te,b,x,y,C,O,S),e++}void 0!==t.dataset.if&&ee.third.push("}")}if(!n[I]||!n[I+"_static"]||"true"==t.dataset.hasSlot||""!=C){if(!n[I]){const[e,t]=p(I,I,Z,ee,te,y,"",S);b.push(...t),c.push(...e),c.push(`$RekenBase.classRegistry['${Q}']=${("$main"==Q?"":"$")+Q.replace("-","_")}`),n[Q]=!0}if("true"==t.dataset.hasSlot||""!=C){Q=E(I);const[e,t]=p(Q,I,Z,ee,te,y,C,S);c.push(...e),c.push(`$RekenBase.classRegistry['${Q}']=${("$main"==Q?"":"$")+Q.replace("-","_")}`),n[Q]=!0}else if("$main"!==I&&(Q=I+"_static",!n[Q])){const[e,t]=p(Q,I,Z,ee,te,y,C,S);c.push(...e),c.push(`$RekenBase.classRegistry['${Q}']=${("$main"==Q?"":"$")+Q.replace("-","_")}`),n[Q]=!0}}else Q=I+"_static";t.dataset.className=Q,f.push(`    ${r}.$class = new ${("$main"==Q?"":"$")+Q.replace("-","_")}(${r})`),m.third.push("    {");let ne=[];for(let e of Object.keys(t.dataset))if(e.startsWith("arg")||e.startsWith("bind")){let n=e.substring(3).toLowerCase();e.startsWith("bind")&&(n=e.substring(4).toLowerCase());let s=t.dataset[e];s=A(s,S);let r=E("arg");/^[a-zA-Z_$][0-9a-zA-Z_$.\[\]\']*$/.test(s)?d(s)?m.third.push("      let "+r+" = '"+s+"'"):0<s.indexOf("'")?m.third.push("      let "+r+" = "+s+""):S.find(e=>0<=e.indexOf(s.split(" ")[1]))?m.third.push("      let "+r+" = "+s+""):m.third.push("      let "+r+" = ((typeof "+s+"!== 'undefined' && !("+s+" instanceof Element))||typeof "+s+"=='function'?"+s+":'"+s+"')"):isNaN(s)?m.third.push("      let "+r+" = `"+s+"`"):m.third.push("      let "+r+" = "+s),ne.push(`${n}:${r}`)}let se=ne.join(",");0<ne.length&&(se+=","),se+=C,m.third.push(`      ${s}.$class.controller({${se}})`),m.third.push("    }");break;case"rest1":if(e)break;case"rest":{let e=I.substring(0,I.indexOf(":")),n=I.substring(I.indexOf(":")+1),r="",a=n.indexOf(":");0==a&&(n=n.substring(1)),0<a&&!(n.startsWith("http")||n.startsWith("${"))&&(r=(n.startsWith("[")?"":".")+n.substring(0,a),n=n.substring(a+1));let i="{}";t.dataset.restOptions&&(i=t.dataset.restOptions),t.dataset.restOptions1&&(i=t.dataset.restOptions1),i=A(i,S);const[d,l,o]=k(e);d&&(e=o,S.push(l)),m.third.push("    $RekenBase.processRestCall("+s+",`"+n+"`, "+i+", (js)=>{ if ((this instanceof $main && !"+d+") || !this.hasOwnProperty('"+e+"')) "+e+"=js"+r+"; else this."+e+"=js"+r+";$mainInstance.controller({})})");break}default:if(N.startsWith("attr")||N.startsWith("attr1")&&!e){let e=h(N.substring(N.startsWith("attr1")?5:4));(e.startsWith("data")||e.startsWith("aria"))&&(e=o(e)),a.includes(e.toLowerCase())?m.third.push("if ("+I+"){"+s+".setAttribute('"+e+"', `"+I+"`)}else{"+s+".removeAttribute('"+e+"')}"):m.third.push("if ("+s+".getAttribute('"+e+"') !== `"+I+"`) "+s+".setAttribute('"+e+"', `"+I+"`)")}else if(N.startsWith("on")||N.startsWith("on1")&&!e){let n=N.substring(N.startsWith("on1")?3:2).toLowerCase();const s=I.split(":");let a=I,i=null;1<s.length&&(i=s[0],i=A(i,S,"this."),a=s.slice(1).join(":"));let d=E(n);if(f.push(r+".dataset.event_"+n+" = '"+d+"'"),e&&N.startsWith("on1Bind"))continue;g.push({elemId:void 0===u?r:u,eventType:n,handlerEventCheck:"  if (!("+(i?"("+i+")&&":"")+"$RekenBase.isEventHandler(e.target, '"+n+"', '"+d+"'))) return;",handlerName:d,handlerCode:a,forContext:"let [$ctxIdx,$ctxElems] = $RekenBase.indexesInForAncestors(e.target);"+v(t).contextString+";",refs:O})}}}}if(!t.dataset.component&&!t.dataset.for){let e=0;for(let n of t.children)l(!1,n,s+W(e),r+W(e),u,c,f,m,g,b,x,y,C,O,S),e++;(void 0!==t.dataset.if||void 0!==t.dataset.route)&&m.third.push("} else {$RekenBase.disableTimers("+s+")}")}else null==t.dataset.if1||e||m.third.push("} else {$RekenBase.disableTimers("+s+")}")},o=e=>{let t="";for(const n of e)n.match(/[a-z]/i)&&n===n.toUpperCase()&&0<t.length&&(t+="-"),t+=n.toLowerCase();return t},h=e=>e.charAt(0).toLowerCase()+e.slice(1),u=e=>{if("TEMPLATE"!=e.tagName&&"component"in e.dataset){let t=c(e.dataset.component);if(null!=t){for(let t of e.children)u(t);const n=t.querySelectorAll("slot[name]");for(let s=0;s<n.length;s++){t.dataset.hasSlot="true";let r=n[s],a=e.querySelector(`[slot=${r.getAttribute("name")}]`);null!=a&&(r.parentElement.insertBefore(a,r),r.parentElement.removeChild(r))}const s=t.querySelector("slot");if(null!=s&&0<e.childNodes.length){t.dataset.hasSlot="true";let n=s;for(let t,r=e.childNodes.length-1;0<=r;r--){t=e.childNodes[r];const a=t.tagName;if("undefined"!=typeof a&&0<=O.indexOf(a.toLocaleLowerCase())){const e=document.createElementNS("http://www.w3.org/2000/svg",a.toLocaleLowerCase());e.innerHTML=t.innerHTML;for(const n of t.getAttributeNames())e.setAttribute(n,t.getAttribute(n));t=e}s.parentElement.insertBefore(t,n),n=t}s.parentElement.removeChild(s)}let r=["data-ref","data-action","data-style","data-class","data-if","data-timer","data-interval","data-route","data-rest","data-rest-options","data-calc","data-var"];for(let n of e.getAttributeNames()){if(0<=r.indexOf(n)){t.setAttribute(n+"1",e.getAttribute(n));continue}if(n.startsWith("data-on")){t.setAttribute("data-on1"+n.substring(7),e.getAttribute(n));continue}if(n.startsWith("data-attr")){t.setAttribute("data-attr1"+n.substring(9),e.getAttribute(n));continue}null==t.getAttribute(n)?null!=e.getAttribute(n)&&t.setAttribute(n,e.getAttribute(n)):((n.startsWith("data-arg")||n.startsWith("data-bind"))&&t.setAttribute(n,e.getAttribute(n)),"class"==n&&t.classList.add(e.getAttribute("class")))}e.parentElement.replaceChild(t,e)}}else for(let t of e.children)u(t)},c=e=>{let n=t[e];if(n===void 0){let s=document.querySelector(`template[data-component='${e}']`);if(null==s||null==s.content||0==s.content.children.length)return console.error(`Component ${e}: no component definition found`),null;for(let e of s.content.children)if("STYLE"!==e.tagName&&"SCRIPT"!==e.tagName){const t=e.tagName.toLocaleLowerCase();if(0<=O.indexOf(t)){n=document.createElementNS("http://www.w3.org/2000/svg",t),n.innerHTML=e.innerHTML;for(let t of e.getAttributeNames())n.setAttribute(t,e.getAttribute(t))}else n=e;break}u(n),n.setAttribute("data-component",e),t[e]=n}let s=n.cloneNode(!0);return s},p=(e,t,n,s,r,a,i,d)=>{let l=document.querySelector("template[data-component='"+t+"']");const o=e==t||"$main"==e;let h=[];const[u,c]=f(l,d);u.push("$root");const p=g(l,"arg"),v=g(l,"bind"),y=v.map(e=>e.substring(0,e.indexOf("="))),$=[...p,...v],k=$.map(e=>e.substring(0,e.indexOf("="))),[A,C]=m(l,u,$);if(h.push("//=============================================================================="),h.push(`class ${("$main"==e?"":"$")+e.replace("-","_")} extends ${o?"$RekenBase":"$"+t.replace("-","_")} {`),o&&"$main"!=e){h.push(...C),h.push("  constructor($root) {"),h.push("  super($root)"),h.push("    this.$root = $root;"),h.push(...c);for(let e of u.filter(e=>"$root"!=e))h.push(`    this.${e} = ${e}`);return h.push("  }"),h.push("  }"),[h,b(l)]}if(h.push("  constructor($root) {"),h.push("  super($root)"),h.push("    this.$root = $root;"),"$main"==e){h.push(...c);for(let e of u.filter(e=>"$root"!=e))h.push(`    this.${e} = ${e}`)}h.push(...n);for(let l of r)h.push("    "+l.elemId+".addEventListener('"+l.eventType+"', event => this."+l.handlerName+"(event))");h.push("  }"),h.push("  static createInstance(elem) {"),h.push(`    return new ${("$main"==e?"":"$")+e.replace("-","_")}(elem);`),h.push("  }");let E=$.join(",");0<$.length&&(E+=","),E+=i,h.push(`  controller({${E}}) {`);for(let l of u)h.push(`    let ${l} = this.${l}`);for(let l of A)h.push(l);if("$main"===e)for(let e of a)h.push("    "+e);h.push(...x(l)),h.push(...s.first),0<s.third.length+s.second.length&&(h.push("    let $v, elem, $arrVar"),h.push(...s.second),h.push(...s.third));for(let l of $){let e=l.substring(0,l.indexOf("="));h.push("    this."+e+" = "+e)}for(let l of u.filter(e=>"$root"!=e))h.push(`    this.${l} = ${l}`);h.push("  }");for(let l of r){h.push("  "+l.handlerName+"(e) {"),""!==(l.handlerEventCheck??"").trim()&&h.push("  "+l.handlerEventCheck),h.push("    let $elem");for(let e of u)h.push(`    let ${e} = this.${e}`);for(let e of k)h.push("    let "+e+" = this."+e);for(let e of a)h.push("    "+e);for(let e of A)h.push(e);h.push("    "+l.forContext),l.refs&&l.refs.forEach(e=>{const[t,n]=e;h.push(`    ${t} = $elem${""===n?"":"."}${n}`)}),h.push("    "+l.handlerCode);for(let e of y)h.push("    if ("+e+"!==this."+e+") $root.dispatchEvent(new CustomEvent('bind_"+e+"', {detail:{'value':"+e+"},bubbles: true}))");for(let e of u.filter(e=>"$root"!=e))h.push(`    this.${e} = ${e}`);l.deferredUpdate||"timer"===l.eventType||"interval"===l.eventType||h.push("    $mainInstance.controller({})"),h.push("  }")}return h.push("}"),[h,b(l)]},f=(e,t)=>{let n=[],s=[];if(e){let t=e.content.querySelector("script");if(null!=t&&!t.hasAttribute("data-calc")&&0<t.childNodes.length){let e=t.textContent.split(/\r?\n/);for(let t of e){if(t=t.trim(),t.startsWith("function"))break;if(""==t||!(t.startsWith("let")||t.startsWith("const")))continue;s.push("    "+t);let e=t.split(/=? /),r=e[1];n.push(r)}}}for(let r of t)s.push("    "+r),n.push(r.split("=")[0].split(" ")[1]);return[n,s]},m=(e,t,n)=>{let s=["    let dispatch = (type, content)=>this.dispatch(type, content)"],r=[],a=!0;if(e){let i=e.content.querySelector("script");if(null!=i&&!i.hasAttribute("data-calc")&&0<i.childNodes.length){let e=i.textContent.split(/\r?\n/);for(let i of e){if(i=i.trim(),i.startsWith("function")){a=!1,i=i.substring(8);let e=i.substring(0,i.indexOf("(")).trim(),d=i.substring(e.length+1,i.indexOf(")")+1).trim();r.push("  "+i.trim());for(let e of t)r.push(`    let ${e} = this.${e}`);for(let e of s)r.push("  "+e);for(let e of n){let t=e.substring(0,e.indexOf("="));r.push("  let "+t+" = this."+t)}s.push(`let ${e} = ${d}=>this.${e}${d}`);continue}a||r.push("    "+i)}}}return[s,r]},g=(e,t,n=!0,s="=")=>{let r=[];if(e)for(let a of Object.keys(e.dataset))if(a.startsWith(t)){let i=a.substring(t.length).toLowerCase();if(n){let t=e.dataset[a];i+=""==t?`${s}undefined`:`${s}${isNaN(t)?"'"+t+"'":t}`}r.push(i)}return r},b=e=>{if(e&&e.content.querySelector("style")){let t=e.content.querySelector("style");if(null!=t&&t.textContent){let n=e.dataset.component,s=t.textContent.split(/\r?\n/);for(let e=0;e<s.length;e++)if(0<s[e].indexOf("{")&&0>s[e].indexOf("@")){let t=s[e].split(","),r=[];for(let e of t){let t=e.indexOf(":host");0<=t&&(e=e.substring(t+5));let s=e.trim();0>".#[:".indexOf(s[0])&&(s=" "+s),e=`[data-component=${n}]`+s,r.push(e)}s[e]=r.join(",")}return s}}return[]},x=e=>{if(e&&e.content.querySelector("script[data-calc]")){let t=e.content.querySelector("script[data-calc]");if(null!=t&&t.textContent){let e=t.textContent.split(/\r?\n/);return e}}return[]},v=(e,t)=>{"undefined"==typeof t&&(t={},t.idx=0,t.contextString="");let n=e.parentElement;if(null!=n&&(v(n,t),"undefined"!=typeof n.dataset.for)){t.forContext=y(n);const e="$ctxIdx["+t.idx+"]",s="$ctxElems["+t.idx+"]";t.idx+=1,t.forContext.idxName=e;const{forIterator:r,contextVar:a}=t.forContext;let i="let "+a+"= {index:"+e+"};";return i+="if (typeof ("+r+") !== 'number' && typeof ("+r+") !== 'undefined')"+a+"['item'] = "+r+"["+e+"];",t.contextString+=i,t.contextString+="$elem = "+s+";",t}return t},y=e=>{let t=e.dataset.for;const n=t.split(":");let s={forIterator:n[1],contextVar:n[0]};return s},$=e=>{if("undefined"==typeof e)return[null,null];let t=null,n=e;return 0<=e.indexOf(":")&&(t=e.substring(0,e.indexOf(":")),n=e.substring(e.indexOf(":")+1)),[n,t]},k=e=>{if(e=e.trim(),e=e.split(";")[0],["const","let","var"].includes(e.split(" ")[0]))return[!0,e,e.split(" ")[1].split("=")[0].trim()];let t;if(0<=(t=e.indexOf("="))&&!/[=><+-/*!%]/.test(e[t-1]+e[t+1])){let t=e.split("=")[0].trim();if(/^[a-zA-Z_$][0-9a-zA-Z_$.\[\]\']*$/.test(t))return[!0,"let "+e,t]}return[!1,e]},A=(e,t,n="")=>{const[s,r,a]=k(e);return s&&(e=n+a,t.push(r)),e};let C=0;const E=e=>`$${e??""}`+C++,O=["svg","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","mask","metadata","missing-glyph","path","pattern","polygon","polyline","radialGradient","rect","set","stop","style","switch","symbol","text","textPath","tref","tspan","use","view","vkern"],S=(e,t)=>{const n=t.dataset.component;return e.querySelectorAll(n).forEach(e=>{let s="DIV";for(const n of t.content.children)if("SCRIPT"!=n.tagName&&"STYLE"!==n.tagName){s=n.tagName;break}s=s.toLocaleLowerCase();const r=0<=O.indexOf(s)?document.createElementNS("http://www.w3.org/2000/svg",s):document.createElement(s);for(let n,s=e.attributes.length-1;0<=s;--s)if(n=e.attributes[s],t.hasAttribute("data-arg-"+n.name)){r.setAttribute("data-arg-"+n.name,e.getAttribute(n.name));continue}else if(t.hasAttribute("data-bind-"+n.name)){r.setAttribute("data-bind-"+n.name,e.getAttribute(n.name));continue}else{if(n.name.startsWith("data-attr")){const s=n.name.substring(10);if(t.hasAttribute("data-arg-"+s)){r.setAttribute("data-arg-"+s,e.getAttribute(n.name));continue}}r.attributes.setNamedItem(e.attributes[s].cloneNode())}let a;for(let t,n=e.childNodes.length-1;0<=n;n--)t=e.childNodes[n],0==r.childNodes.length?r.appendChild(t):r.insertBefore(t,a),a=t;r.setAttribute("data-component",n),e.parentElement.replaceChild(r,e)}),n},N=()=>{let e=[];document.querySelectorAll("template[data-component]").forEach(t=>{e.push(S(document,t)),document.querySelectorAll("template[data-component]").forEach(e=>{S(e.content,t)})}),I(e),e.sort((e,t)=>t.length-e.length)},W=e=>e?`.children[${e}]`:".firstElementChild",I=e=>{document.querySelectorAll("head > style").forEach(t=>{const n=t.textContent.split("\n"),s=[];for(let r of n){if(0<=r.indexOf("{"))for(const t of e)for(let e=0;0<=e;)e=r.indexOf(t,e),0<=e&&((0==e||0<="\t ,>+~]".indexOf(r[e-1]))&&0<="\t ,.:{>+~[".indexOf(r[e+t.length])?(r=r.substring(0,e)+"[data-component="+t+"]"+r.substring(e+t.length),e+=("[data-component="+t+"]").length):e++);s.push(r)}t.textContent=s.join("\n")})},T=(e,t)=>{const n=[];return e.querySelectorAll("div[data-include]").forEach(async e=>{let s=e.dataset.include;if(s){t&&!s.startsWith("/")&&(s=t+"/"+s);const r=fetch(s).then(e=>{if(e.ok)return e.text();throw Error(`${e.status} - ${e.statusText}`)}).then(n=>{e.innerHTML=n;const r=s.split("/");return 1<r.length&&(r.pop(),t=r.join("/")),T(e,t)}).catch(()=>{e.textContent=`File ${s} not found.`});n.push(r)}}),Promise.allSettled(n)},L=()=>{function t(e){let t=[];if(2<e.length){const n=e.substring(2);t=n.split("/")}return t.push(""),t}if(e.routing_path=t(window.location.hash),window.addEventListener("hashchange",()=>{e.routing_path=t(window.location.hash),document.body.parentElement.$class.controller({})}),!s()){let t=[],a=["template {display:none !important;}"];document.body.parentElement.setAttribute("data-component","$main");if(l(!1,document.body.parentElement,"_r","_r",void 0,t,[],{first:[],second:[],third:[]},[],a,[],[],"",[],[]),0<a.length){const e=document.querySelector("head");null==e&&(e=document.createElement("head"),document.body.parentElement.insertBefore(e,document.body));const t=document.createElement("style");t.textContent=a.join("\n"),e.appendChild(t)}t.push("let $mainInstance = $main.createInstance(document.body.parentElement)"),t.push("document.body.parentElement.$class = $mainInstance"),t.push("document.body.dispatchEvent(new CustomEvent('rekeninitialized', {}))"),t.push("$mainInstance.controller({})"),t.push("document.body.dispatchEvent(new CustomEvent('rekenready', {}))");let i=t.join("\n"),d=new Function("reken",i);if(r()||d(e),r()&&!s()){var n=document.createElement("a");let e=document.body.parentElement.innerHTML.split("\n"),t=[];for(let n of e)0<=n.indexOf("reken.js")&&(n=""),t.push(n);e=t,n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent("<html>"+e.join("\n")+"<script>var rkn_server_generated = true</script><script src=\"../src/reken.js\"></script><style>\n"+a.join("\n")+"</style>\n<script>\n"+i+"</script>\n</html>")),console.log(a.join("\n")),console.log(i),n.setAttribute("download",document.title+".txt"),n.textContent="Download Reken page controller",document.body.appendChild(n)}}};e.force_calculate=()=>{document.body.parentElement.$class.controller({})},e.forceCalculate=()=>{console.warn("reken.forceCalculate is deprecated; please use reken.force_calculate. [as of 0.9.2]"),e.force_calculate()},globalThis.reken=e,s()||T(document.body.parentElement).then(()=>{s()||(N(),u(document.body.parentElement)),L()})}