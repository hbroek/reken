<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Reken - Tests</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/mocha/mocha.css" />
  <style>
    short-hand2 {
      background: rgb(0, 128, 0);
    }
    #cp14_2.comp14-border {
      border: 10px green solid;
    }

  </style>
</head>


<body data-on-rekenready="runRekenTests()">
  <div id="mocha"></div>

  <script src="https://unpkg.com/chai/chai.js"></script>
  <script src="https://unpkg.com/chai-dom/chai-dom.js"></script>
  <script src="https://unpkg.com/mocha/mocha.js"></script>

  <script class="mocha-init">
    mocha.setup('bdd');
    mocha.checkLeaks();
    const expect = chai.expect;
  </script>
  <script>
    hello = 'world'
    var a = 10;
    var b = 20;
    var vtext0 = ""
    var vtext1 = "Second value"
    var vnumber2 = 100
    var vnumber3 = 50
    var vcheckbox4 = false;
    var vcheckbox5 = ['one', 'three'];
    var vradio6 = 'THREE'
    var vselect7 = ''
    var vselect8 = 'T2'
    var vtextarea9 = ''
    var vtextarea10 = 'The first words count'
    var vnumber14 = 150


    var swidth = 64
    var sheight = 48
    var sbackground = 'silver'

    let f4 = ['Monkey', "Elephant", "Lion"];

    let f5 = [
      {'firstname': 'Karin', 'lastname': 'Williamson', 'steps': 953},
      {'firstname': 'John', 'lastname': 'Smith', 'steps': 5401},
      {'firstname': 'Maria', 'lastname': 'Samson', 'steps': 11000}
    ];

    let f6 = JSON.parse(JSON.stringify(f5));; //Clone the f5 array
    sumSteps = (total, elem) => {
      return total += elem.steps
    }
    sumStepsToGo = (total, elem) => {
      return total += (elem.steps < 10000?10000-elem.steps:0)
    }
    f6_selected = 1

    f7_loop = 12

    var waitFor = (timeoutms, condition) => new Promise((r, j) => {
      let timeCheck = 1
      var check = () => {
        if(condition()) 
          r(true)
        else if((timeoutms -= timeCheck) < 0)
          j('timed out!')
        else
          setTimeout(check, timeCheck)
      }
      setTimeout(check, timeCheck)
    })
  </script>

  <hr>
  <section>
    <h3>data-text tests</h3>
    <div id="t0" data-text>Wow</div>
    <div id="t1" data-text="${1}">Should not be there</div>
    <div id="t2" data-text="${hello}"></div>
    <div id="t3" data-text="Hello ${hello}"></div>
    <div id="t4" data-text="Hello ${1+1} worlds"></div>
    <div id="t5"><span data-text="a + b = ${a+b}"></span></div>
  </section>
  <hr>
  <section>
    <h3>data-html tests</h3>
    <div id="h0" data-html=""><span>Wow</span></div>
    <div id="h1" data-html="<div>${a}<span>${b}<span></div>">Should not be there</div>
    <div id="h2" data-html="<span>[${hello+a}]</span><span>[${hello+b}]</span>"></div>
  </section>
  <hr>
  <section>
    <h3>data-value tests</h3>
    <div>
      <span id="v0_0" data-text="${vtext0}"></span>
      <label>vtext0:
        <input id="v0" type="text" data-value="vtext0" value="not used">
      </label>
      <span id="v0_1" data-text="${vtext0}"></span>
    </div>
    <div>
      <span id="v1_0" data-text="${vtext1}"></span>
      <label>vtext1:
        <input id="v1" type="text" data-value="vtext1" value="not used">
      </label>
      <span id="v1_1" data-text="${vtext1}"></span>
    </div>
    <div>
      <span id="v2_0" data-text="${vnumber2}"></span>
      <label>vnumber2:
        <input id="v2" type="number" data-value="vnumber2" value="not used">
      </label>
      <span id="v2_1" data-text="${vnumber2}"></span>
    </div>
    <div>
      <span id="v3_0" data-text="${vnumber3}"></span>
      <label>vnumber3:
        <input id="v3" type="range" data-value="vnumber3" value="not used">
      </label>
      <span id="v3_1" data-text="${vnumber3}"></span>
    </div>
    <div>
      <span id="v4_0" data-text="${vcheckbox4}"></span>
      <label>vcheckbox4:
        <input id="v4" type="checkbox" data-value="vcheckbox4" value="not used">
      </label>
      <span id="v4_1" data-text="${vcheckbox4}"></span>
    </div>
    <div>
      <span id="v5_0" data-text="${vcheckbox5}"></span>
      <label>vcheckbox5:
        <input id="v5" type="checkbox" name="vcheckbox5" data-value="vcheckbox5" value="one">
        <input id="v5_2" type="checkbox" name="vcheckbox5" data-value="vcheckbox5" value="two">
        <input id="v5_3" type="checkbox" name="vcheckbox5" data-value="vcheckbox5" value="three">
      </label>
      <span id="v5_1" data-text="${vcheckbox5}"></span>
    </div>
    <div>
      <span id="v6_0" data-text="${vradio6}"></span>
      <label>vradio6:
        <input id="v6" type="radio" name="vradio6" data-value="vradio6" value="ONE">
        <input id="v6_2" type="radio" name="vradio6" data-value="vradio6" value="TWO">
        <input id="v6_3" type="radio" name="vradio6" data-value="vradio6" value="THREE">
      </label>
      <span id="v6_1" data-text="${vradio6}"></span>
    </div>
    <div>
      <span id="v7_0" data-text="${vselect7}"></span>
      <label>vselect7:
        <select id="v7" data-value="vselect7">
          <option>One</option>
          <option>Two</option>
          <option>Three</option>
        </select>
      </label>
      <span id="v7_1" data-text="${vselect7}"></span>
    </div>
    <div>
      <span id="v8_0" data-text="${vselect8}"></span>
      <label>vselect8:
        <select id="v8" data-value="vselect8">
          <option>T1</option>
          <option>T2</option>
          <option>T3</option>
        </select>
      </label>
      <span id="v8_1" data-text="${vselect8}"></span>
    </div>
    <div>
      <span id="v9_0" data-text="${vtextarea9}"></span>
      <label>vtextarea9:
        <textarea id="v9" data-value="vtextarea9">
        </textarea>
      </label>
      <span id="v9_1" data-text="${vtextarea9}"></span>
    </div>
    <div>
      <span id="v10_0" data-text="${vtextarea10}"></span>
      <label>vtextarea10:
        <textarea id="v10" data-value="vtextarea10">
        </textarea>
      </label>
      <span id="v10_1" data-text="${vtextarea10}"></span>
    </div>
    <script>
      let vselect11 = 1
    </script>
    <div>
      <span id="v11_0" data-text="${vselect11}"></span>
      <label>vselect11:
        <select id="v11" data-value="vselect11" data-for="vfor11:10">
          <option data-attr-value="${vfor11.index}" data-text="T${vfor11.index}"></option>
        </select>
      </label>
      <span id="v11_1" data-text="${vselect11}"></span>
    </div>

    <script>
      let vcheckbox12 = ['2', '4']
    </script>
    <div>for checkbox12:
      <span id="v12_0" data-text="${vcheckbox12}"></span>
        <ul id="v12" data-for="vfor12:5">
          <li>
            <input type="checkbox" name="vcheckbox12" data-value="vcheckbox12" data-attr-value="${vfor12.index}">
              <span data-text="T${vfor12.index}"></span>
          </li>
        </ul>
      <span id="v12_1" data-text="${vcheckbox12}"></span>
    </div>
    <script>
      let vradio13 = 2
    </script>
    <div>for radios13:
      <span id="v13_0" data-text="${vradio13}"></span>
        <ul id="v13" data-for="vfor13:5">
          <li>
            <input type="radio" data-attr-name="vcheckbox13" data-value="vradio13" data-attr-value="${vfor13.index}">
              <span data-text="T${vfor13.index}"></span>
          </li>
        </ul>
      <span id="v13_1" data-text="${vradio13}"></span>
    </div>
    <div>
      <span id="v14_0" data-text="${vnumber14}"></span>
      <label>vnumber14:
        <input id="v14" type="range" data-attr-min="100" data-attr-max="250" data-value="vnumber14" value="not used">
      </label>
      <span id="v14_1" data-text="${vnumber14}"></span>
    </div>
  </section>
  <section>
    <h3>data-style tests</h3>
    <div id="s0" data-style="width:${swidth}px;height:${sheight}px;background-color:${sbackground}">
      Hello class
    </div>
  </section>
  <hr>

  <script>
    let class2 = true
    let class3 = false
    let class50 = false
    let class51 = true
  </script>

  <section>
    <h3>data-class tests</h3>
    <div id="c0" data-class="class0:true">
      Hello class
    </div>

    <div id="c1" data-class="class1:false">
      Hello class
    </div>

    <div id="c2" data-class="class2">
      Hello class
    </div>
    <input id="c2_1" type="checkbox" data-value="class2">

    <div id="c3" data-class="class3">
      Hello class
    </div>
    <input id="c3_1" type="checkbox" data-value="class3">

    <div id="c4" data-class="class40:true;class41:false;class42:true;class43:false">
      Hello class
    </div>

    <div id="c5" data-class="class50;class51">
      Hello class
    </div>
    <input id="c5_1" type="checkbox" data-value="class50">
    <input id="c5_2" type="checkbox" data-value="class51">


  </section>
  <hr>

  <script>
    let if0 = false;
    let if1 = true;
    let if2 = true;
    let if3 = false;
    let if4 = true;
    let if5 = true;
    let if6 = false;

  </script>
  <section>
    <h3>data-if tests</h3>
    <div id="i0" data-if="if0">
      Hello not visible
    </div>
    <label>if0:<input id="i0_1" type="checkbox" data-value="if0"></label>
    
    <div id="i1" data-if="if1">
      Hello visible
    </div>
    <label>if1:<input id="i1_1" type="checkbox" data-value="if1"></label>

    <div id="i2" data-if="if2">
      <span id="i2_2" data-text="${if2}"></span>
    </div>
    <label>if2:<input id="i2_1" type="checkbox" data-value="if2"></label>

    <div id="i3" data-if="if3" data-for="if3_1:3">
      <span data-text="${if3_1.index}"></span>
    </div>
    <label>if3:<input id="i3_1" type="checkbox" data-value="if3"></label>

    <div id="i4" data-if="if4" data-style="background:rgb(255, 0, 0)">if/style test
    </div>
    <label>if4:<input id="i4_1" type="checkbox" data-value="if4"></label>

    <div id="i5" data-if="i5class:if5">if/class test
      <strong id="i5t" data-text="${if5}"></strong>
    </div>
    <label>if5:<input id="i5_1" type="checkbox" data-value="if5"></label>

    <div id="i6" data-if="if6" data-text="${if6}">check data-text is not executed</div>
    <label>if6:<input id="i6_1" type="checkbox" data-value="if6"></label>

    <test-if7 id="i7" data-if="true"></test-if7>
    <template data-component="test-if7">
      <div>test-if7</div>
    </template>

    <script>
      let if8 = true;
    </script>
    <div id="i8" data-if="if8" data-text="${if8}" style="display:flex">Check that display is reset to flex.</div>
    <label>if8:<input id="i8_1" type="checkbox" data-value="if8"></label>

  </section>
  <hr>
  <section>
    <h3>data-route tests</h3>
    <script>
      
    </script>
    <div id="rt0" data-route="/">rt0</div>
    <div id="rt1" data-route="/rt1">rt1</div>
    <div id="rt2" data-route="/rt2">
      <span id="srt2_0" data-route="">srt0</span>
      <span id="srt2_1" data-route="srt1"></span>
      <span id="srt2_2" data-route="srt2"></span>
    </div>
    <div id="rt3" data-route="/rt3/subrt3/srt3">rt3/subrt3/srt3</div>
    <div id="rt4" data-route="class_rt4:/rt4">rt4</div>

    <div id="rt5" data-route="/rt5/#rt5value" data-text="rt5/${rt5value}"></div>

    <div id="rt6" data-route="/rt6">rt6</div>
    <div id="rt61" data-route="/rt61">rt61</div>

    <div id="rt7" data-route="/rt7" data-if="true">rt7</div>
  </section>

  <hr>
  <section>
  <script>
    let a0 = 0
    let a1 = 10
    let a2 = 20
    let a3 = 30
 </script>
  <h3>data-action tests</h3>
  <button type="button" data-action="a0=a0+1" id="a0">Increment a0</button>
  <button type="button" data-action="a1=a1-1" id="a1" data-text="Decrement a1 = ${a1}"></button>
  <button type="button"><div data-action="a2=a2+1" id="a2">Increment a2</div></button>
  <button type="button" id="a3b" data-action="a3=a3+1"><div id="a3">Increment a3</div></button>
  </section>
  <hr>
 
  <script>
    let at_width = 64;
    let at_height= 48;
    let at2_disabled = false;
  </script>
  
  <section>
    <h3>data-attr-* tests</h3>
    <img id="at0" data-attr-width="${at_width}" data-attr-height="${at_height}">Image</div>
    <button id="at1" data-action="at_width=32; at_height=24" type="button">Update dimensions</button>

    <!-- test boolean attrs-->
    <button id="at2" data-action="at2_disabled = true" data-attr-disabled="at2_disabled" type="button">Click to disable</button>

    <!-- test hyphened attribute -->
    <div id="at3" data-attr-data-at3="${'data-a3'}">AT3</div>

  </section>
  <hr>

  <section>
    <script>
      let o_0 = 5
      let o_1 = 'a'
      let o_2 = ''
      let o_3 = 'abc'
    </script>
    <h3>data-on tests</h3>

    <button type="button" data-on-click="o_0=o_0+1" data-text="Increment o0 ${o_0}" id="o0"></button>
    <div id=o0_0 data-text="${o_0}"></div>

    <input id="o1" data-on-change="o_1='z'"></div>
    <div id=o1_0 data-text="${o_1}"></div>

    <input id="o2" data-on-keydown="o_2=e.keyCode" data-on-keyup="o_2=e.keyCode"></div>
    <div id=o2_0 data-text="${o_2}"></div>

    <input id="o3" data-on-change="o_3=o_3.trim()" data-value="o_3"></div>
    <div id=o3_0 data-text="${o_3}"></div>
  </section>

  <section>
    <h3>data-for tests</h3>
    <ol id="f0" data-for="f0v:5">OL
      <li>5 elements</li>
    </ol>
    <ol id="f1" data-for="f1v:2">Outer
      <ol id="f1_1" data-for="f1_1v:3">Inner
        <li>3 x 2 elements</li>
      </ol>
    </ol>
    <ul id="f2" data-for="f2v:5">UL
      <li data-text="Element ${f2v.index+1} of 5 elements"></li>
    </ul>
    <ul id="f3" data-for="f3v:2">Outer
      <ul id="f3_1" data-for="f3_1v:3">Inner
        <li data-text="2 x 3 elements ${f3v.index} - ${f3_1v.index}"> </li>
      </ul>
    </ul>
    <ul id="f4" data-for="f4v:f4">UL
      <li data-text="${f4v.index+1} - ${f4v.item}"></li>
    </ul>
    <table>
      <thead><th>#</th><th>First name</th><th>Last name</th><th>Steps</th><th>Steps to go</th></thead>
      <tbody id="f5" data-for="f5v:f5">
        <tr>
          <td data-text="${f5v.index+1}"></td>
          <td data-text="${f5v.item.firstname}"></td>
          <td data-text="${f5v.item.lastname}"></td>
          <td data-text="${f5v.item.steps}"></td>
          <td data-text="${f5v.item.steps<10000?10000-f5v.item.steps:'Done'}"></td>
        </tr>
      </tbody>
      <tfoot>
        <thead><th data-text="${f5.length}"></th><th></th><th></th><th data-text="${f5.reduce(sumSteps, 0)}"></th><th data-text="${f5.reduce(sumStepsToGo, 0)}"></th></thead>
      </tfoot>
    </table>  

    <table>
      <thead><th></th><th>#</th><th>First name</th><th>Last name</th><th>Steps</th><th>Steps to go</th><th>Action</th></thead>
      <tbody id="f6" data-for="f6v:f6">
        <tr>
          <td><input type="radio" name="f6radio" data-value="f6_selected" data-attr-value="${f6v.index}"></td>
          <td data-text="${f6v.index+1}"></td>
          <td data-text="${f6v.item.firstname}"></td>
          <td data-text="${f6v.item.lastname}"></td>
          <td><input type="number" data-value="f6v.item.steps"></td>
          <td data-text="${f6v.item.steps<10000?10000-f6v.item.steps:'Done'}"></td>
          <td><button type="button" data-action="f6.splice(f6v.index,1)">Delete</button></td>
        </tr>
      </tbody>
      <tfoot>
        <thead><th></th><th data-text="${f6.length}"></th><th></th><th></th><th data-text="${f6.reduce(sumSteps, 0)}"></th><th data-text="${f6.reduce(sumStepsToGo, 0)}"></th><th></th></thead>
      </tfoot>
    </table>  
    <ol id="f7" data-for="f7v:f7_loop">12 elements
      <li data-text="${f7v.index+1} of 12 elements"</li>
    </ol>

    <script>
      let outer8Var = 0;
      let inner8Var = 0
    </script>
    <div id="f8">
      <div data-for="outer8:3">
        <div data-for="inner8:3">
            <button data-action="outer8Var=outer8.index;inner8Var=inner8.index;" data-text="${outer8.index}-${inner8.index}"></button>
        </div>
      </div>
      <div id="f81" data-text="${outer8Var} - ${inner8Var}"></div>
    </div>

    <script>
      let for9ObjectArray = [{c0:1, c1:10}, {c0:100, c1:110}]
    </script>
    <div id="f9" data-for="f9:for9ObjectArray">
      <div>
        <span data-text="${f9.index}"></span>
        <span data-text="c0:${f9.item.c0}"></span>
        <button data-action="f9.item.c0++">Increase c0</button>
        <span data-text="c1:${f9.item.c1}"></span>
        <button data-action="f9.item.c1++">Increase c1</button>
      </div>
    </div>

    <script>
      let for10StringArray = ['Charlie', 'Foxtrot', 'Tango']
    </script>
    <div id="f10" data-for="f10:for10StringArray">
      <div>
        <span data-text="${f10.index}"></span>
        <span data-text="${f10.item}"></span>
        <input data-value="f10.item">
      </div>
    </div>

    <script>
      let for11StringArray = ['Charlie', 'Foxtrot', 'Tango']
    </script>
    <div id="f11" data-for="f11:for11StringArray">
      <span data-text="${f11.index}"></span>
      <span data-text="${f11.item}"></span>
      <input data-value="f11.item">
    </div>

    <script>
      let button_f12 = 0
      let outer12Var = 0;
      let inner12Var = 0;
    </script>
    <div id="f12">
      <div data-for="outer12:3">
        <div data-for="inner12:3">
          <button data-action="button_f12=0;outer12Var=outer12.index;inner12Var=inner12.index;" data-text="${outer12.index}-${inner12.index}-0"></button>
          <button data-action="button_f12=1;outer12Var=outer12.index;inner12Var=inner12.index;" data-text="${outer12.index}-${inner12.index}-1"></button>
          <button data-action="button_f12=2;outer12Var=outer12.index;inner12Var=inner12.index;" data-text="${outer12.index}-${inner12.index}-2"></button>
      </div>
    </div>
    <div id="f121" data-text="${outer12Var} - ${inner12Var} - ${button_f12}"></div>
    </div>

    <script>
        let f13_arr13 = undefined;
    </script>
    <div id="f13" data-rest="f13_arr13:json/array.json"  data-for="inner13:f13_arr13">
        <div data-text="${inner13.item.name}"></div>
    </div>

    <ol id="f14" data-for="f14v:5:3">OL
      <li data-text="Element ${f14v.index}-${f14v.itemIndex}-${f14v.item}"></li>
    </ol>

    <script>
      const my_numbers15 = ['zero', 'one','two','three','four','five','six','seven','eight','nine']
    </script>
    <ol id="f15" data-for="f15v:my_numbers15:3:5">OL
      <li data-text="Element ${f15v.index}-${f15v.itemIndex}-${f15v.item}"></li>
    </ol>


  </section>
  <hr>
  <section>
    <h3>data-calc tests</h3>
    <script>let c0=0</script>
    <script data-calc>c0=10</script>
    <div id="ca0" data-text="${c0}"></div>

    <script>let ca10=1;let ca11</script>
    <div id="ca1" data-text="${ca11}"></div>
    <input id="ca1_0" type="number" data-value="ca10">
    <button id="ca1_1" data-action="ca10=21">Set ca10 to 21</button>
    <script data-calc>ca11=ca10+10</script>
 
    <script>let ca20 = true</script>
    <div>
      <input id="ca2_0" data-calc="if (ca20 && document.activeElement != elem) elem.focus()" type="number">
      <input id="ca2_1" data-calc="if (!ca20 && document.activeElement != elem) elem.focus()" type="number">
      <button id="ca2_2" data-action="ca20=!ca20">Toggle focus</button>
    </div>
  </section>
  <hr>
  <section>
    <h3>data-rest tests</h3>
    <script>
      r0 = {theNumber:0};
      r1 = {theNumber:0};
      r1_filename = 'one'

      let r2v; // Prevent global namespace leak warning
      nameList=[];

      let r5 = {theNumber:0};
      let r5_options = {fetch:false}

      let r6_options = {}

      function text7Converter(text, options) {
        return {theNumber:parseInt(text)}
      }
      r7 = {theNumber:0};
      let r7_options = {
        transformer: text7Converter
      }
    </script>

    <div id="r0" data-text="${r0.theNumber}" data-rest="r0:json/one.json"></div>

    <div>
      <select id="r1_0" data-value="r1_filename">
        <option>one</option>
        <option>two</option>
      </select>
      <div id="r1" data-text="${r1.theNumber}" data-rest="r1:json/${r1_filename}.json"></div>
    </div>
    <div id="r2_1">
      <ul id="r2" data-rest="nameList:namesData:json/names.json" data-for="r2v:nameList">
        <li data-text=${r2v.item}></li>
      </ul>
    </div>
    <script>
      let r3_options = {'method': 'DELETE'}
      let r3_result = {}
    </script>
    <div id="r3_1">
      <ul id="r3" data-rest="r3_result:json/names.json" data-rest-options="r3_options">
      </ul>
    </div>
    <script>
      let r4_options = {'method': 'GET'}
      let r4_result = {}
      r4_options.r4_callback_valid = false;

      const r4_callback = (options, json) => {
        options.r4_callback_valid =
          options === r4_options
          && json != null;
      }
      r4_options['callback'] = r4_callback;
    </script>
    <div id="r4_1">
      <ul id="r4" data-rest="r4_result:json/names.json" data-rest-options="r4_options">
      </ul>
    </div>

    <div id="r5" data-text="${r5.theNumber}" data-rest="r5:json/one.json" data-rest-options="r5_options"></div>
    <button id="r5_button" data-action="r5_options.fetch=true" type="button">Trigger the rest call</button>

    <div id="r6" data-rest="r0:json/one.json" data-rest-options="r6_options"></div>

    <div id="r7" data-text="${r7.theNumber}" data-rest="r7:json/one.txt" data-rest-options="r7_options"></div>

    <script>
      let rest8_0 = "json/rest8_0.json"
    </script>

    <rest8 id="r8_0" url="${rest8_0}"></rest8>
    <rest8 id="r8_1" url="json/rest8_1.json"></rest8>
    <template data-component="rest8" data-arg-url>
      <script>
        let result = '';
      </script>
      <div data-rest="result:${url}" data-text="${result!=''?result.content:'Loading'}">Rest 8</div>
    </template>

    <script>
      let r9 = ""
    </script>
    <div id="r9" data-rest="r9:[1]:json/array.json" data-text="${r9.name}"></div>

    <script>
      let r10;
      let r10_options = {
        reviver: (a,b) => {
            if (['sell_by'].indexOf(a)>=0) {
                return new Date(b);
            }
            else return b;
        }
      }
    </script>
    <div id="r10" data-rest="r10:json/array.json" data-rest-options="r10_options">
    </div>

  </section>
  <hr>
  <section>
    <h3>data-component tests</h3>
    <template data-component="comp0"><div>Component 0</div></template>
    <div id="cp0" data-component="comp0"></div>

    <script>
      let cp2_0s = "data-text value"
    </script>
    <template data-component="comp1" data-arg-arg1="default value" data-arg-arg2="">
      <div data-text="${arg1}${arg2}"></div>
    </template>
    <div id="cp1" data-component="comp1"></div>
    <div id="cp1_0" data-component="comp1" data-arg-arg1="arg passed in"></div>
    <div id="cp1_1" data-component="comp1" data-arg-arg1="${cp2_0s}"></div>
    <div id="cp1_2" data-component="comp1" data-arg-arg1="cp2_0s"></div>
    <div id="cp1_3" data-component="comp1" data-arg-arg1="0" data-arg-arg2="1"></div>
    <div id="cp1_4" data-component="comp1" data-arg-arg1="justAStringNotAVar"></div>

    <template data-component="comp2" data-arg-arg1="arg">
      <script>
        let a = 10
        let b = "Hello"
        let c = a+b
        let d = a+20; 
      </script>
      <div data-text=${arg1}-${a}-${b}-${c}-${d}></div>
    </template>
    <div id="cp2" data-component="comp2"></div>

    <template data-component="comp3" data-arg-arg1="arg">
      <script>
        let vr3 = 10
      </script>
      <div>
        <div data-html="<em>${vr3}</em>"></div>
        <input data-value="vr3"/>
      </div>
    </template>
    <div id="cp3" data-component="comp3">
    </div>

    <template data-component="comp4" data-arg-arg1="arg">
      <script>
        let vr4 = 10
      </script>
      <div>
        <input data-value="vr4"/>
        <div data-component="comp40" data-arg-arg1="arg" data-arg-arg2="${vr4}"> </div>
      </div>
    </template>
    <template data-component="comp40" data-arg-arg1 data-arg-arg2>
      <script>
        let vr40 = 100
      </script>
      <div>
        <div data-html="<em>${vr40}-${arg1}-${arg2}</em>"></div>
        <input data-value="vr40"/>
        <button type="button" data-action="vr40=200">vr40</button>
      </div>
    </template>
    <div id="cp4" data-component="comp4" data-arg-arg1="cp4"></div>

    <template data-component="comp5" data-arg-idx>
      <script>
        let i5var = 10
      </script>
      <li>
        <span>
          <span data-text="comp 5 instance ${idx.index+1} - ${i5var}"></span>
        </span>
        <input data-value="i5var"/>
        <button type="button" data-action="i5var=100" data-text="btn${idx.index+1}""></button>
      </li>
    </template>
    <ul id="cp5" data-for="idx5:3">Uls
      <li data-component="comp5" data-arg-idx="idx5"></li>
    </ul>

    <script>
      let cp6arr = [10,20,30]
    </script>
    <template data-component="comp6" data-arg-arr>
      <div>
        <ul data-for="arr6:arr">
          <li>
            <span>
              <span data-text="comp 6 instance ${arr6.index+1} - ${arr6.item}"></span>
            </span>
            <input data-value="arr[arr6.index]"/>
            <button type="button" class="update" data-action="arr[arr6.index]=100" data-text="btn${arr6.index+1}""></button>
            <button type="button" class="delete"  data-action="arr.splice(arr6.index,1)" data-text="Remove ${arr6.index+1}""></button>
          </li>
        </ul>
        <button type="button" id="cp600" data-action="arr.push((arr.length+1)*100)">Add</button>
        <button type="button" id="cp601" data-action="arr.pop()">Delete</button>
        <div class="summary" data-text="arr_elems: ${arr}">
      </div>
    </template>
    <div id="cp6" data-component="comp6" data-arg-arr="cp6arr"></div>

    <template data-component="cp7cell">
      <script>
        let cellValue = 10
      </script>
      <span>
        <input type="range" data-value="cellValue">
        <button type="button" data-action="cellValue=0">Reset</button>
        <span data-text="${cellValue}"></span>
      </span>
    </template>
    <template data-component="cp7row">
      <script>
        let cells = 3
      </script>
      <div>
        <span>
          <input type="range" data-value="cells">
          <button type="button" data-action="cells=0">Reset</button>
          <span data-text="${cells}"></span>
        </span>
        <div data-for="cp70i:3">
          <span style="border: 1px solid green" data-component="cp7cell"></span>
        </div>
      </div>
    </template>
    <template data-component="cp7grid">
      <script>let rows = 1</script>
    <div>
      <span>
          <input type="range" data-value="rows">
          <button type="button" data-action="rows=0">Reset</button>
          <span data-text="${rows}"></span>
      </span>

      <div data-for="cp7i:2">
        <div style="border: 1px solid blue" data-component="cp7row"></div>
      </div>
    </div>
    </template> 
    <div id="cp7" style="border: 1px solid red" data-component="cp7grid"></div> 

    <script>
      let a8 = ["One", "Two", "Three"]
    </script>
    <template data-component="cp8state">
      <script>
        let status = true
      </script>
      <div>
          <input type="checkbox" data-value="status"/>
          <div data-text="${status}"></div>
      </div>
    </template>
    <div>
      <div id="cp8" data-for="idx8:a8">
        <div data-component="cp8state"></div>
      </div>
      <button id="cp8Delete" data-action="a8.splice(2,1)" type="button">Delete row 2</button>
      <button id="cp8Add" data-action="a8.splice(1,0, 'Four')" type="button">Add row 2</button>
    </div>

    <script>
        let cp9selectedItems = ['3']
    </script>
    <div>
      <h3 id="cp9_h0" data-text="Selected:[${cp9selectedItems}]"></h3>
      <div id="cp9" data-component="list9"></div>
      <template data-component="list9">
          <style>
              :host {
                margin:0;
                background: lightblue;
              }
              @media (max-width: 999999px) {
              :host {
                background-color: brown;
              }
            }
          </style>
          <ul data-for="it:5">
              <li data-component="listItem9" data-arg-vrb="it" data-arg-sel="cp9selectedItems"></li>
          </ul>
      </template>

      <template data-component="listItem9" data-arg-vrb data-arg-sel>
          <style>
              :host {
                  display:block;
                  margin:0;
                  background: gray;
                  line-height: 1em;
                  padding: 0.125em;
              }
              :host > * {
                  padding: 0 0.125em;
              }
              :host.selected {
                  background: silver;
              }
          </style>
          <li data-class="selected:sel.indexOf(''+vrb.index)>=0">
              <input name="selection" data-attr-value="${vrb.index}" data-value="sel" type="checkbox">
              <span data-text="Item - ${vrb.index}">ListItem</span>
          </li>
      </template>
    </div>

    <!-- Test component recalculate logic  -->
    <script>
      let base10 = 10
      let count10 = 0
    </script>
    <template data-component="cp10calc">
      <script data-calc>
        count10 = base10 + 10
      </script>
      <div>
          <div data-text="${count10}"></div>
      </div>
    </template>
    <div>
      <div id="cp10" data-component="cp10calc"></div>
      <button id="cp10Recalc" data-action="base10 = 20" type="button">Set base to 20</button>
    </div>

    <!-- Test bindable component arguments  -->
    <script>
      let arg11_00 = 10
      let arg11_01 = 11
      let arg11_10 = 110
      let arg11_11 = 111
      let argval11 = 130
    </script>
    <template data-component="cp11bind" data-bind-bind1 data-bind-bind2 data-arg-setval="20">
      <div>
          <div data-text="${bind1}"></div>
          <div data-text="${bind2}"></div>
          <button data-action="bind1=setval" type="button">Set bound1 arg to the value of setval</button>
          <button data-action="bind2=bind2+1" type="button">Increment bound2 arg</button>
          <button data-action="setval=setval+1" type="button">Increment setval this should not propagate</button>
      </div>
    </template>
    <div>
      <p>
        <div id="cp11_0" data-component="cp11bind" data-bind-bind1="arg11_00" data-bind-bind2="arg11_01"></div>
        <span id="cp11_01" data-text="${arg11_00} - ${arg11_01}"></span>
      </p>
      <p>
        <div id="cp11_1" data-component="cp11bind" data-bind-bind1="arg11_10" data-bind-bind2="arg11_11" data-arg-setval="argval11"></div>
        <span id="cp11_11"  data-text="${arg11_10} - ${arg11_11} - ${argval11}"></span>
      </p>
    </div>
    <script>
      let cp12var = false
    </script>
    <template data-component="comp12" data-arg-active>
      <div data-if="active">
        <div data-text="Is active">Is not active</div>
      </div>
    </template>
    <div id="cp12" data-component="comp12" data-arg-active="cp12var"></div>
    <label>cp12:<input id="cp12_1" type="checkbox" data-value="cp12var"></label>

    <template data-component="comp13" data-arg-item>
      <li data-text="comp 13 name ${item.name}"></li>
    </template>
    <script>
        let i13var = [
          {name: 'John'},
          {name: 'Mary'}
        ]
      </script>
    <ul id="cp13" data-for="idx13:i13var">Uls
      <li data-component="comp13" data-arg-item="idx13.item"></li>
    </ul>

    <script>
      let comp14_3Show = true
      let comp14_4Show = true
    </script>
    <template data-component="comp14" data-arg-arg1 data-arg-arg2="true">
      <style>
        :host {
          background: blue;
          color:white;
        }
        .comp14 {
          border: 1px solid red;
        }
      </style>
      <div class="comp14" data-text="${arg1}" data-if="arg2">Default</div>
    </template>
    <comp14 id="cp14_0" arg1="Untouched"></comp14>
    <comp14 id="cp14_1" data-style="background:yellow;color:black;" arg1="Override style"></comp14>
    <comp14 id="cp14_2" data-class="comp14-border:true" arg1="Override class"></comp14>
    <label>Show component: <input id="cp14_3c" type="checkbox" data-value="comp14_3Show"></label>
    <comp14 data-if="comp14_3Show" id="cp14_3" arg1="${comp14_3Show?'Shown':'Hidden'}" arg2="true"></comp14>

    <label>Show component: <input id="cp14_4c" type="checkbox" data-value="comp14_4Show"></label>
    <comp14 data-if="comp14_4Show" id="cp14_4" arg1="${comp14_4Show?'Shown':'Hidden'}" arg2="false"></comp14>

    <br>
    <script>
      let cp15text = ''
    </script>
    <template data-component="cp15button">
      <button data-action="cp15text='inner'"><slot>cp15button</slot></button>
    </template>
    <div id="cp15text" data-text="${cp15text}"></div>
    <cp15button id="cp15_0">default action</cp15button>
    <cp15button id="cp15_1" data-action="cp15text='outer'">instance action</cp15button>

    <br>
    <script>
      let cp16text = ''
    </script>
    <template data-component="cp16button">
      <button data-on-click="cp16text='inner'"><slot>cp16button</slot></button>
    </template>
    <div id="cp16text" data-text="${cp16text}"></div>
    <cp16button id="cp16_0">default action</cp16button>
    <cp16button id="cp16_1" data-on-click="cp16text='outer'">instance action</cp16button>
    <br>
    <script>
      let cp17text = ''
    </script>
    <template data-component="cp17button">
      <button data-attr-disabled="false"><slot>cp17button</slot></button>
    </template>
    <div id="cp17text" data-text="${cp17text}"></div>
    <cp17button id="cp17_0">default attribute</cp17button>
    <cp17button id="cp17_1" data-attr-disabled="true">instance disabled</cp17button>
    <br>
    <script>
      color18_0 = "orange"
      color18_1 = color18_0
      doColor18_0 = false;
      doColor18_1 = false;
    </script>
    <template data-component="cp18circle" data-arg-color="orange">
      <div data-text="${color}" data-timer="1:doColor18_0:color18_0='blue';doColor18_0=false;"></div>
    </template>
    <input id="cp18_0cb" type="checkbox" data-value="doColor18_0"/><cp18circle id="cp18_0" color="${color18_0}"></cp18circle>
    <input id="cp18_1cb" type="checkbox" data-value="doColor18_1"/><cp18circle id="cp18_1" data-timer="1:doColor18_1:color18_1='pink';doColor18_1=false" id="cp18_1" color="${color18_1}"></cp18circle>
    <br>
    <script>
      color19_0 = "orange"
      color19_1 = color19_0
      doColor19_0 = false;
      doColor19_1 = false;
    </script>
    <template data-component="cp19circle" data-arg-color="orange">
      <div data-text="${color}" data-interval="1:doColor19_0:color19_0='blue';doColor19_0=false;"></div>
    </template>
    <input id="cp19_0cb" type="checkbox" data-value="doColor19_0"/><cp19circle id="cp19_0" color="${color19_0}"></cp19circle>
    <input id="cp19_1cb" type="checkbox" data-value="doColor19_1"/><cp19circle id="cp19_1" data-interval="1:doColor19_1:color19_1='pink';doColor19_1=false" id="cp19_1" color="${color19_1}"></cp19circle>
    <br>
  <hr>
  <template data-component="cp20route">
    <div>
      <h1>cp20root</h1>
    </div>
  </template>

  <cp20route id="cp20route" data-route="cp20route:/comp-route"></cp20route>

  <script>
    let cp21_options = {fetch:false};
    let cp21Var = {};
  </script>
  <template data-component="cp21rest" data-arg-arg1>
    <div data-text="${arg1?arg1.theNumber:'Loading'}">
    </div>
  </template>
  <h3><cp21rest id="cp21" data-rest="cp21Var:json/one.json" arg1="cp21Var"></cp21rest></h3>

  <script>let cp22 = '0'</script>
  <template data-component="cp22div">
    <div data-number="0" data-text="${cp22}"></div>
  </template>
  <cp22div id="cp22div" data-calc="cp22=elem.dataset.number;elem.dataset.number=parseInt(elem.dataset.number)+1"></cp22div>

  <!-- dispatch event from component -->
  <script>
    let cp23 = 0
    let cp23Detail = ''
  </script>
  <template data-component="cp23div">
    <div>
      <button type="button" data-action="dispatch('cp23event', 'OK')">Fire Event</button>
    </div>
  </template>
  <cp23div id="cp23div" data-on-cp23event="cp23++;cp23Detail=e.detail"></cp23div>
  <div id='cp23_div' data-text="${cp23}-${cp23Detail}"></div>

  <!-- Nested slot same component -->
  <script>
  </script>
  <template data-component="nested24" data-arg-arg1="argument 1" data-bind-bind1="bind 1">
    <div><span data-text="${arg1}"></span>
        <slot></slot>
        <span data-text="${bind1}"></span>
    </div>
  </template>
  <nested24 id="cp24">
    <nested24 arg1="Hello" bind1="US">
      Henry
    </nested24>
  </nested24>

  <!-- Nested 2 different components -->
  <template data-component="nested25a" data-arg-arg1="argument 1" data-bind-bind1="bind 1">
    <div><span data-text="a - ${arg1}"></span>
        <slot></slot>
        <span data-text="a - ${bind1}"></span>
    </div>
  </template>
  <template data-component="nested25b" data-arg-arg1="argument 1" data-bind-bind1="bind 1">
    <div><span data-text="b - ${arg1}"></span>
        <slot></slot>
        <span data-text="b - ${bind1}"></span>
    </div>
  </template>
  <nested25a id="cp25a">
    <nested25b>
      <nested25a>
        <nested25b>
        </nested25b>
      </nested25a>
    </nested25b>
  </nested25a>

  <!-- Nested component inside for loops -->
    <script>
      let cpOutput26 = ''
    </script>
  <template data-component="nested26a" data-arg-arga>
    <div>
      <span data-text="pre - ${arga}"></span>
      <slot></slot>
      <button type="button" data-action="cpOutput26=`26a ${arga}-button`" data-text="26a ${arga}-button"></button>
      <span data-text="post - ${arga}"></span>
  </template>
  <template data-component="nested26b" data-arg-arga data-arg-argb>
    <div>
      <span data-text="pre - ${arga}:${argb}"></span>
      <slot></slot>
      <button type="button" data-action="cpOutput26=`26b ${arga}:${argb}-button`" data-text="26b ${arga}:${argb}-button"></button>
      <span data-text="post - ${arga}:${argb}"></span>
  </template>

  <span id="cp26Text" data-text="${cpOutput26}"></span>
  <div id="cp26" data-for="l26a:2">
    <nested26a arga="${l26a.index}">
      <button type="button" data-action="cpOutput26=`26a slot ${l26a.index}-button`" data-text="26a slot ${l26a.index}-button"></button>      
      <div data-for="l26b:2">
        <nested26b arga="${l26a.index}" argb="${l26b.index}"></nested26b>
      </div>
    </nested26a>
  </div>

  <!-- Nested component containing for loops -->
  <template data-component="nested27a">
    <div>
      <div data-for="l27a:2">
        <span data-text="pre - ${l27a.index}"></span>
          <slot></slot>
        <span data-text="post - ${l27a.index}"></span>
    </div>
  </template>
  <template data-component="nested27b" data-arg-arga>
    <div>
      <div data-for="l27b:2">
        <span data-text="pre - ${arga}:${l27b.index}"></span>
          <slot></slot>
        <span data-text="post - ${arga}:${l27b.index}"></span>
      </div>
  </template>

  <nested27a id="cp27">
    <nested27b arga="${l27a.index}">
      <span data-text="span27 ${l27a.index}:${l27b.index}"></span>
    </nested26b>
  </nested27a>

  <!-- Nested component with actions -->
    <script>
      let cpOutput28 = ''
    </script>
    <template data-component="nested28a" data-arg-label="some text">
      <div>
        <button type="button" data-action="cpOutput28=`28a ${label}-before`" data-text="28a ${label}-before"></button>
        <slot></slot>
        <button type="button" data-action="cpOutput28=`28a ${label}-after`" data-text="28a ${label}-after">28a after</button>
    </template>

    <span id="cp28aText" data-text="${cpOutput28}"></span>
    <nested28a id="cp28a" label="outer">
      <button type="button" data-action="cpOutput28=`28a ${label}-slot`" data-text="28a ${label}-slot">28a slot</button>
      <nested28a label="inner">
        <button type="button" data-action="cpOutput28=`28a ${label}-slot`" data-text="28a ${label}-slot">28a slot</button>
      </nested28a>
    </nested28a>
  
    <!-- Nested slot pass arg and bind value through -->
    <script>
        let cpInput29 = 'value29'
    </script>
    <template data-component="nested29" data-bind-bindvar data-arg-argvar>
      <div><span data-text="${bindvar}-${argvar}"></span>
          <slot></slot>
          <span data-text="${bindvar}-${argvar}"></span>
          <label>bindvar: <input type="text" data-value="bindvar"/></label>
      </div>
    </template>
    <span id="cp29Text" data-text="${cpInput29}"></span>
    <nested29 id="nested29" bindvar="cpInput29" argvar="42">
        <nested29 bindvar="bindvar" argvar="argvar"></nested29>
    </nested29>

    <template data-component="nested30" data-arg-padding="1em">
      <style>
        :host.inner {
          background: hsl(200,80%,50%);
        }
        :host.outer {
          background: hsl(200,80%,90%);
        }
        :host.component {
          border: solid 1px black;
        }
      </style>
      <div data-style="padding:${padding}" class="component">
        <slot></slot>
      </div>
    </template>
    <nested30 id="nested30" class="outer" padding="48px">
      <nested30 class="inner" padding="32px">Hello</nested30>
    </nested30>
    <!-- Test js reserved words can be used as string argument values-->
    <template data-component="cp31" data-arg-arg31_0>
      <div data-text="${arg31_0}">Should not be here</div>
    </template>
    <cp31 id="cp31" arg31_0="delete"></cp31>

    <!-- Test support for passing array and obj refs-->
    <template data-component="cp32" data-arg-arg32_0>
      <div data-text="${arg32_0}">Should not be here</div>
    </template>
    <script>
      let cp32Array = [{'a':10},{'b':20}]
    </script>
    <cp32 id="cp32" arg32_0="cp32Array[1]['b']"></cp32>
  <section>
    <!-- Test component shorthand functionality  -->
    <template data-component="short-hand1">
      <div>short-hand1</div>
    </template>
    <short-hand1 id="sh1"></short-hand1>

    <template data-component="short-hand2" data-arg-hand2>
      <div data-text="${hand2}"></div>
    </template>
    <short-hand2 id="sh2" hand2="short-hand2"></short-hand2>

    <template data-component="short-hand31" data-arg-sh31>
      <div data-text="${sh31}"></div>
    </template>
    <template data-component="short-hand3" data-arg-sh3>
      <div>
        <short-hand31 sh31="sh3 - ${sh3}"></short-hand31>
      </div>
    </template>
    <short-hand3 id="sh3" sh3="short-hand3"></short-hand3>
  </section>
  <hr>
  <!-- Test component slot functionality  -->
  <section>
    <test-slot1 id="ts11"></test-slot1>
    <test-slot1 id="ts12"><h2>Has slot text</h2></test-slot1>
    <template data-component="test-slot1">
      <div>
        <slot>Has no slot test</slot>
      </div>
    </template>

    <test-slot2>
      <test-subslot2 id="ts21">
        <h2>Hello from the subslot</h2>
      </test-subslot2>
    </test-slot2>
    <template data-component="test-slot2">
      <div>
        <h1>Before</h1>
        <slot>Has no slot test</slot>
        <h1>After</h1>
      </div>
    </template>
    <template data-component="test-subslot2">
      <div>
        <slot><h2>Subslot has not text</h2></slot>
      </div>
    </template>

  </section>
  <hr>
  <section>
    <h3>data-timer tests</h3>
    <script>
      let tib0 = false;
      let tii0 = 0;
      let tib1 = false;
      let tii1 = 0;
      let tib2 = true;
      let tib3 = false;
      let tib4 = false;
      tib4_cnt = 0;
    </script>
    <div data-timer="1:tib0:tii0++"></div>
    <input id="ti0" type="checkbox" data-value="tib0">

    <div data-if="tib1" data-timer="1:true:tii1++"></div>
    <input id="ti1" type="checkbox" data-value="tib1">

    <ul id="ti2" data-for="i:3">
      <li data-timer="1:tib2:if (e.target.dataset.timed=='done') tib2=false;e.target.dataset.timed='done';" data-text="${i.index} - Item${i.index}"></li>
    </ul>

    <template data-component="tic3" data-bind-atib3="false">
      <script>
        let count3 = 0;
      </script>  
      <div data-timer="1:atib3:count3++;atib3=false" data-text="Count:${count3}"></div>
    </template>
    <tic3 id="tic3" atib3="tib3"></tic3>
    <input id="ti3" type="checkbox" data-value="tib3">

    <template data-component="tic4" data-bind-atib4="false">
      <script>
        let timer4 = 0;
      </script>
      <div data-timer="1:atib4&&timer4<1:timer4++;" data-text="Count:${timer4}"></div>
    </template>
    <div id="tic4" id="" data-for="i:2">
      <tic4 atib4="tib4"></tic4>
    </div>
    <input id="ti4" type="checkbox" data-value="tib4">
  </section>
  <hr>
  <section>
    <h3>data-interval tests</h3>
    <script>
      let inb0 = false;
      let ini0 = 0;

      let inb1 = false;
      let ini1 = 0;

      let inb2 = true;

      let inb3 = false;

      let inb4 = false;
    </script>
    <div data-interval="1:inb0:ini0++"></div>
    <input id="in0" type="checkbox" data-value="inb0">

    <div data-if="inb1" data-interval="1:true:ini1++"></div>
    <input id="in1" type="checkbox" data-value="inb1">

    <ul id="in2" data-for="i:3">
      <li data-interval="5:inb2:e.target.dataset.timed=e.target.dataset.timed?parseInt(e.target.dataset.timed)+1:0" data-text="${i.index} - Item${i.index}"></li>
    </ul>
    <input id="ini2" type="checkbox" data-value="inb2">

    <template data-component="inc3" data-bind-ainb3="false">
      <script>
        let count = 0;
      </script>  
      <div data-interval="1:ainb3:count++;ainb3=false" data-text="Count:${count}"></div>
    </template>
    <inc3 id="inc3" ainb3="inb3"></inc3>
    <input id="in3" type="checkbox" data-value="inb3">

    <template data-component="inc4" data-bind-ainb4="false">
      <script>
        let timer = 0;
      </script>
      <div data-timer="1:ainb4&&timer<2:timer++;" data-text="Count:${timer}"></div>
    </template>
    <div id="inc4" id="" data-for="i:2">
      <inc4 ainb4="inb4"></inc4>
    </div>
    <input id="in4" type="checkbox" data-value="inb4">
  </section>
  <hr>

  <section>
    <h3>data-ref tests</h3>
    <script>
      let rf0
    </script>
    <div id="rf0" data-ref="rf0">Hello ref0</div>

    <script>
      let ref1
      let ref1Save
      let ref1s = []
    </script>
    <div id="rf1" data-for="r1:3">
      <button type="button" data-calc="if (ref1s.indexOf(ref1) < 0) ref1s.push(ref1)" // Add only 1 unique reference
        data-ref="ref1" data-text="ref1 btn ${r1.index}" data-action="ref1Save = ref1"></button>
    </div>

    <script>
      let ref2
      let ref2Save
      let ref2s = []
    </script>
    <div id="rf2" data-for="r2:2">
      <span data-for="r21:2">
        <button type="button" data-calc="if (ref2s.indexOf(ref1) < 0) ref2s.push(ref2)" // Add only 1 unique reference
          data-ref="ref2" data-text="ref2 btn ${r2.index}-${r21.index}" data-action="ref2Save = ref2"></button>
      </span>
    </div>

    <script>
      let ref3
      let ref3Comp
    </script>
    <ref3-comp id="rf3" data-ref="ref3"></ref3-comp>
    <template data-component="ref3-comp">
      <script>let ref3_span</script>
      <div data-ref="ref3Comp" data-calc="ref3Comp.dataset.refValue3=20" data-for="rf:3">
        <span data-calc="ref3_span.dataset.refValue3=(rf.index+1)*10" data-ref="ref3_span" data-text="ref: ${rf.index+1}"></span>
      </div>
    </template>
  </section>
  <hr>

  
  <!-- Test component component loading functionality  -->
  <section>
    <comp-include1 id="di1"><h3>h3 comp include1</h3></comp-include1>
    <sub-lib1 id="sdi1"></sub-lib1>
    <div data-include="includes/library.html"></div>
    <comp-include2 id="di2"><h3>h3 comp include2</h3></comp-include2>
    <sub-lib2 id="sdi2"></sub-lib2>
    <div data-include="includes/library2.html"></div>
    <div id="il0" data-include="includes/library3.html"></div>
  </section>
  <hr>

  <!-- Github issues test section   -->
  <!-- -------------- ------------- -->

  <!-- https://github.com/hbroek/reken/issues/17                   -->
  <!-- Verify application scope names are not overriding by Reken  -->
  <section>
    <script>
      let root = 'root';
      let _v = '_v';
      let isEventHandler = 'isEventHandler';
      let indexesInForAncestors = 'indexesInForAncestors';
      let ctxIdx = 'ctxIdx';
      let _l = '_l';
      let classRegistry = 'classRegistry';
      let _main = '_main';
      let processRestCall = 'processRestCall';
      let disableTimers = 'disableTimers';
      let _mainInstance = '_mainInstance';
    </script>
    <div>
      <div id="issue17_0" data-text="${root}"></div>
      <div id="issue17_1" data-text="${_v}"></div>
      <div id="issue17_2" data-text="${isEventHandler}"></div>
      <div id="issue17_3" data-text="${indexesInForAncestors}"></div>
      <div id="issue17_4" data-text="${ctxIdx}"></div>
      <div id="issue17_5" data-text="${_l}"></div>
      <div id="issue17_6" data-text="${classRegistry}"></div>
      <div id="issue17_7" data-text="${_main}"></div>
      <div id="issue17_8" data-text="${processRestCall}"></div>
      <div id="issue17_9" data-text="${disableTimers}"></div>
     <div id="issue17_10" data-text="${_mainInstance}"></div>
    </div>
  </section>
  <hr>

  <script>
  function runRekenTests() {
    mocha.setup('bdd');
    mocha.checkLeaks();
    const expect = chai.expect;

    var assert = chai.assert;
    var $ = ((id) => (document.getElementById(id)));
    describe('data-text tests', () => {
      it('Test no expression', (done) => {
        expect($('t0')).to.have.text('');
        done();
      })
      it('Test number literal', (done) => {
        expect($('t1')).to.have.text('1');
        done();
      })
      it('Test string literal', (done) => {
        expect($('t2')).to.have.text('world');
        done();
      })
      it('Test text + string literal', (done) => {
        expect($('t3')).to.have.text('Hello world');
        done();
      })
      it('Test numeral expression + string literal', (done) => {
        expect($('t4')).to.have.text('Hello 2 worlds');
        done();
      })
      it('Element does not get an id', (done) => {
        expect($('t5').children[0]).to.have.id('');
        done();
      })
      it('Element without id to have text', (done) => {
        expect($('t5').children[0]).to.have.text('a + b = 30');
        done();
      })
    })
    describe('data-html tests', () => {
      it('Test no expression', (done) => {
        expect($('h0')).to.be.empty;
        done();
      })
      it('Html with expression in div and span', (done) => {
        expect($('h1')).not.to.be.empty;
        expect($('h1')).to.contain.text('1020')
        done();
      })
      it('Html with expression in 2 spans', (done) => {
        expect($('h2')).not.to.be.empty;
        expect($('h2')).to.have.length(2);
        expect($('h2')).to.contain('span')
        expect($('h2')).to.contain.text('[world10][world20]')
        done();
      })
    })
    describe('data-value tests', () => {
      it('Start with empty value and change value', (done) => {
        expect($('v0')).to.have.attr('value', 'not used') //value can be ignored.
        const testString0 = "First String"
        assert($('v0').value == '', "Value is empty")
        $('v0').value = testString0
        $('v0').dispatchEvent(new Event('change'));
        assert($('v0').value == testString0, `Value set to ${testString0}`)
        expect($('v0_0')).to.have.text(testString0);
        expect($('v0_1')).to.have.text(testString0);
        done();
      })
      it('Start with string value and change value, then set to empty string', (done) => {
        let testString1 = "Second value"
        assert($('v1').value == testString1, testString1)
        testString1 = "Value changed"
        $('v1').value = testString1
        $('v1').dispatchEvent(new Event('change'));
        assert($('v1').value == testString1, `Value set to ${testString1}`)
        expect($('v1_0')).to.have.text(testString1);
        expect($('v1_1')).to.have.text(testString1);
        testString1 = ""
        $('v1').value = testString1
        $('v1').dispatchEvent(new Event('change'));
        assert($('v1').value == testString1, `Value set to ${testString1}`)
        expect($('v1_0')).to.have.text(testString1);
        expect($('v1_1')).to.have.text(testString1);
        done();
      })
      it('Start with number value 100', (done) => {
        let testNumber2 = 100
        assert($('v2').value == testNumber2, "Value is 100")
        expect($('v2_0')).to.have.text("" + testNumber2);
        expect($('v2_1')).to.have.text("" + testNumber2);
        testNumber2 = 200
        $('v2').value = testNumber2
        $('v2').dispatchEvent(new Event('change'));
        assert($('v2').value == testNumber2, `Value set to ${testNumber2}`)
        expect($('v2_0')).to.have.text("" + testNumber2);
        expect($('v2_1')).to.have.text("" + testNumber2);
        done();
      })
      it('Start with range number value 50', (done) => {
        let testNumber3 = 50
        assert($('v3').value == testNumber3, "Value is 50")
        expect($('v3_0')).to.have.text("" + testNumber3);
        expect($('v3_1')).to.have.text("" + testNumber3);
        testNumber3 = 25
        $('v3').value = testNumber3
        $('v3').dispatchEvent(new Event('input'));
        assert($('v3').value == testNumber3, `Value set to ${testNumber3}`)
        expect($('v3_0')).to.have.text("" + testNumber3);
        expect($('v3_1')).to.have.text("" + testNumber3);
        done();
      })
      it('Start with single checkbox false', (done) => {
        let testCheckbox4 = false
        assert($('v4').checked == testCheckbox4, "Value is unchecked")
        expect($('v4_0')).to.have.text("" + testCheckbox4);
        expect($('v4_1')).to.have.text("" + testCheckbox4);
        testCheckbox4 = true
        $('v4').checked = testCheckbox4
        $('v4').dispatchEvent(new Event('change'));
        assert($('v4').checked == testCheckbox4, `Value set to ${testCheckbox4}`)
        expect($('v4_0')).to.have.text("" + testCheckbox4);
        expect($('v4_1')).to.have.text("" + testCheckbox4);
        done();
      })
      it('Start with multiple checkbox one and three checked, then uncheck one, then check 2', (done) => {
        let testCheckbox5 = ['one', 'three'];
        assert($('v5').checked == true, "Value is unchecked")
        assert($('v5_2').checked == false, "Value is unchecked")
        assert($('v5_3').checked == true, "Value is unchecked")
        expect($('v5_0')).to.have.text("" + testCheckbox5.toString());
        expect($('v5_1')).to.have.text("" + testCheckbox5.toString());  

        $('v5').checked = false
        $('v5').dispatchEvent(new Event('change'));
        assert($('v5').checked == false, "Value is unchecked")
        assert($('v5_2').checked == false, "Value is unchecked")
        assert($('v5_3').checked == true, "Value is unchecked")
        testCheckbox5 = ['three'];
        expect($('v5_0')).to.have.text("" + testCheckbox5.toString());
        expect($('v5_1')).to.have.text("" + testCheckbox5.toString());

        $('v5_2').checked = true
        $('v5_2').dispatchEvent(new Event('change'));
        assert($('v5').checked == false, "Value is unchecked")
        assert($('v5_2').checked == true, "Value is unchecked")
        assert($('v5_3').checked == true, "Value is unchecked")
        testCheckbox5 = ['three', 'two'];
        expect($('v5_0')).to.have.text("" + testCheckbox5.toString());
        expect($('v5_1')).to.have.text("" + testCheckbox5.toString());
        done();
      })
      it('Start with multiple radio 3 checked, then set radio 2', (done) => {
        let testRadio6 = 'THREE';
        assert($('v6').checked == false, "Value is unchecked")
        assert($('v6_2').checked == false, "Value is unchecked")
        assert($('v6_3').checked == true, "Value is checked")
        expect($('v6_0')).to.have.text("" + testRadio6.toString());
        expect($('v6_1')).to.have.text("" + testRadio6.toString());

        $('v6_2').checked = true;
        $('v6_2').dispatchEvent(new Event('change'));
        assert($('v6').checked == false, "Value is unchecked")
        assert($('v6_2').checked == true, "Value is unchecked")
        assert($('v6_3').checked == false, "Value is unchecked")
        testRadio6 = 'TWO';
        expect($('v6_0')).to.have.text("" + testRadio6.toString());
        expect($('v6_1')).to.have.text("" + testRadio6.toString());
        done();
      })
      it('Start with empty select value and change value', (done) => {
        const testString7 = "Two"
        assert($('v7').value == '', "Value is empty")
        expect($('v7_0')).to.have.text('');
        expect($('v7_1')).to.have.text('');
        $('v7').value = testString7
        $('v7').dispatchEvent(new Event('change'));
        assert($('v7').value == testString7, `Value set to ${testString7}`)
        expect($('v7_0')).to.have.text(testString7);
        expect($('v7_1')).to.have.text(testString7);
        done();
      })
      it('Start with T2 selected value and change value to T3', (done) => {
        let testString8 = "T2"
        expect($('v8_0')).to.have.text(testString8);
        expect($('v8_1')).to.have.text(testString8);
        assert($('v8').value == 'T2', "Value is T2")

        testString8 = "T3"
        $('v8').value = testString8
        $('v8').dispatchEvent(new Event('change'));
        assert($('v8').value == testString8, `Value set to ${testString8}`)
        expect($('v8_0')).to.have.text(testString8);
        expect($('v8_1')).to.have.text(testString8);
        done();
      })
      it('Start with empty textarea and change value', (done) => {
        const testString9 = "Two little piggies"
        assert($('v9').value == '', "Value is empty")
        expect($('v9_0')).to.have.text('');
        expect($('v9_1')).to.have.text('');
        $('v9').value = testString9
        $('v9').dispatchEvent(new Event('input'));
        assert($('v9').value == testString9, `Value set to ${testString9}`)
        expect($('v9_0')).to.have.text(testString9);
        expect($('v9_1')).to.have.text(testString9);
        done();
      })
      it('Start with populated textarea and change value', (done) => {
        let testString10 = vtextarea10;
        assert($('v10').value === testString10, "Value is empty")
        expect($('v10_0')).to.have.text(testString10);
        expect($('v10_1')).to.have.text(testString10);
        testString10 = "The last ones too"
        $('v10').value = testString10
        $('v10').dispatchEvent(new Event('input'));
        assert($('v10').value == testString10, `Value set to ${testString10}`)
        expect($('v10_0')).to.have.text(testString10);
        expect($('v10_1')).to.have.text(testString10);
        done();
      })
      it('On a data-for generated select list start with 1 as the selected value and change value to 9', (done) => {
        let testString11 = "1"
        expect($('v11_0')).to.have.text(testString11);
        expect($('v11_1')).to.have.text(testString11);
        assert($('v11').value == testString11, "Value is 1")

        testString11 = "9"
        $('v11').value = testString11
        $('v11').dispatchEvent(new Event('change'));
        assert($('v11').value == testString11, `Value set to ${testString11}`)
        expect($('v11_0')).to.have.text(testString11);
        expect($('v11_1')).to.have.text(testString11);
        done();
      })
      it('On a data-for generated list with checkbox 2 pre-selected.', (done) => {
        let testString12 = '2,4'
        expect($('v12_0')).to.have.text(testString12);
        expect($('v12_1')).to.have.text(testString12);
        const v_ul12 = $('v12')
        const v12inputs = v_ul12.querySelectorAll('input');
        assert(v12inputs[0].checked == false, "Value is unchecked")
        assert(v12inputs[1].checked == false, "Value is unchecked")
        assert(v12inputs[2].checked == true, "Value is checked")
        assert(v12inputs[3].checked == false, "Value is unchecked")
        assert(v12inputs[4].checked == true, "Value is checked")

        v12inputs[0].checked = true;
        fireEvent(v12inputs[0],'value')

        testString12 = '2,4,0'
        expect($('v12_0')).to.have.text(testString12);
        expect($('v12_1')).to.have.text(testString12);
        
        assert(v12inputs[0].checked == true, "Value is checked")
        assert(v12inputs[1].checked == false, "Value is unchecked")
        assert(v12inputs[2].checked == true, "Value is checked")
        assert(v12inputs[3].checked == false, "Value is unchecked")
        assert(v12inputs[4].checked == true, "Value is checked")

        done();
      })
      it('Start with multiple connected by data-attr-name radio 2 checked, then set radio 0', (done) => {
        let testString13 = '2'
        expect($('v13_0')).to.have.text(testString13);
        expect($('v13_1')).to.have.text(testString13);
        const v_ul13 = $('v13')
        const v13inputs = v_ul13.querySelectorAll('input');
        assert(v13inputs[0].checked == false, "Value is unchecked")
        assert(v13inputs[1].checked == false, "Value is unchecked")
        assert(v13inputs[2].checked == true, "Value is checked")
        assert(v13inputs[3].checked == false, "Value is unchecked")
        assert(v13inputs[4].checked == false, "Value is unchecked")

        v13inputs[0].checked = true;
        fireEvent(v13inputs[0],'value')

        testString13 = '0'
        expect($('v13_0')).to.have.text(testString13);
        expect($('v13_1')).to.have.text(testString13);
        
        assert(v13inputs[0].checked == true, "Value is checked")
        assert(v13inputs[1].checked == false, "Value is unchecked")
        assert(v13inputs[2].checked == false, "Value is unchecked")
        assert(v13inputs[3].checked == false, "Value is unchecked")
        assert(v13inputs[4].checked == false, "Value is unchecked")
        done();
      })
      it('Start with range number value 150 with a data-attr-min of 100 and data-attr-max of 250 ', (done) => {
        let testNumber14 = 150
        assert($('v14').value == testNumber14, "Value is 150")
        expect($('v14_0')).to.have.text("" + testNumber14);
        expect($('v14_1')).to.have.text("" + testNumber14);
        testNumber14 = 50
        $('v14').value = testNumber14
        $('v14').dispatchEvent(new Event('input'));
        assert($('v14').value != testNumber14, `Value set to ${testNumber14}`)
        expect($('v14_0')).to.not.have.text("" + testNumber14);
        expect($('v14_1')).to.not.have.text("" + testNumber14);
        done();
      })

    })
    describe('data-style tests', () => {
      it('width, heigh background', (done) => {
        expect($('s0')).to.have.style('width', '64px');
        expect($('s0')).to.have.style('height', '48px');
        expect($('s0')).to.have.style('background-color', 'rgb(192, 192, 192)');
        done();
      })
    })
    describe('data-class tests', () => {
      it('class added', (done) => {
        expect($('c0')).to.have.class('class0');
        done();
      })
      it('class not added', (done) => {
        expect($('c1')).not.to.have.class('class1');
        done();
      })
      it('class added with short form', (done) => {
        expect($('c2')).to.have.class('class2');
        $('c2_1').checked = false;
        $('c2_1').dispatchEvent(new Event('change'));
        expect($('c2')).to.not.have.class('class2');

        done();
      })
      it('class not added with short form', (done) => {
        expect($('c3')).not.to.have.class('class3');
        $('c3_1').checked = false;
        $('c3_1').dispatchEvent(new Event('change'));
        expect($('c3')).to.not.have.class('class3');

        done();
      })
      it('Multiple classes: class40, class42 added. class41, class43 not.', (done) => {
        expect($('c4')).to.have.class('class40');
        expect($('c4')).to.not.have.class('class41');
        expect($('c4')).to.have.class('class42');
        expect($('c4')).to.not.have.class('class43');
        done();
      })
      it('Multiple classes added using short form', (done) => {
        expect($('c5')).not.to.have.class('class50');
        expect($('c5')).to.have.class('class51');

        $('c5_1').checked = true;
        $('c5_1').dispatchEvent(new Event('change'));
        expect($('c5')).to.have.class('class50');
        expect($('c5')).to.have.class('class51');

        $('c5_2').checked = false;
        $('c5_2').dispatchEvent(new Event('change'));
        expect($('c5')).to.have.class('class50');
        expect($('c5')).to.not.have.class('class51');

        done();
      })

    })
    describe('data-if tests', (done) => {
      it('if not displayed', (done) => {
        expect($('i0')).not.to.be.displayed;
        //Make true
        $('i0_1').checked = true;
        $('i0_1').dispatchEvent(new Event('change'));
        expect($('i0')).to.be.displayed;
        done();
      })
      it('if displayed', (done) => {
        expect($('i1')).to.be.displayed;
        //Make true
        $('i1_1').checked = false;
        $('i1_1').dispatchEvent(new Event('change'));
        expect($('i1')).not.to.be.displayed;

        done();
      })
      it('Make sure that if element children do no get updated when hidden', (done) => {
        expect($('i2_2')).to.be.displayed;
        expect($('i2_2')).to.have.text('true')
        //Make false
        $('i2_1').checked = false;
        $('i2_1').dispatchEvent(new Event('change'));
        expect($('i2')).not.to.be.displayed;
        expect($('i2_2')).to.have.text('true') //Means if element contents are not updated when if negative

        expect($('i2_2')).to.be.displayed;
        expect($('i2_2')).to.have.text('true')

        done();
      })
      it('Make sure that if element with a for loop does not execute when hidden', (done) => {
        expect($('i3')).not.to.be.displayed;
        expect($('i3_1').checked).to.be.false;
        expect($('i3')).to.have.length(1);
        //Make true; Ie show and execute element
        $('i3_1').checked = true;
        $('i3_1').dispatchEvent(new Event('change'));
        expect($('i3')).to.be.displayed;
        expect($('i3_1').checked).to.be.true;
        expect($('i3')).to.have.length(3);

        done();
      })
      it('Make sure that if element works with data-style attribute', (done) => {
        expect($('i4')).to.be.displayed;
        expect($('i4_1').checked).to.be.true;
        expect($('i4')).to.have.style('background-color', 'rgb(255, 0, 0)');

        //Make true; Ie show and execute element
        $('i4_1').checked = false;
        $('i4_1').dispatchEvent(new Event('change'));
        expect($('i4')).not.to.be.displayed;
        expect($('i4_1').checked).to.be.false;
        expect($('i4')).to.have.style('background-color', 'rgb(255, 0, 0)');
        done();
      })      
      it('Make sure that if element works with class modifier', (done) => {
        expect($('i5')).to.be.displayed;
        expect($('i5t')).to.be.displayed;
        expect($('i5t')).to.have.text('true');
        expect($('i5_1').checked).to.be.true;
        expect($('i5')).to.have.class('i5class');

        //Make false; Ie show and execute element
        $('i5_1').checked = false;
        $('i5_1').dispatchEvent(new Event('change'));
        expect($('i5')).to.be.displayed;
        expect($('i5t')).to.be.displayed; // Not hidden and not modified as the class modifier does not hide it but children are not executed.
        expect($('i5t')).to.have.text('true');
        expect($('i5_1').checked).to.be.false;
        expect($('i4')).to.not.have.class('i5class');
        done();
      })      
      
      it('Make sure that false if does not execute data-text', (done) => {
        expect($('i6')).not.to.be.displayed;
        expect($('i6')).to.have.text('check data-text is not executed');

        //Make false; Ie show and execute element
        $('i6_1').checked = true;
        $('i6_1').dispatchEvent(new Event('change'));
        expect($('i6')).to.be.displayed;
        expect($('i6')).to.have.text('true');
        done();
      })      

      it('Make sure component with data-if renders', (done) => {
        expect($('i7')).to.be.displayed;
        expect($('i7')).to.have.text('test-if7');
        done();
      }) 
      
      it('Make sure display style is reset to flex.', (done) => {
        expect($('i8')).to.be.displayed;
        expect($('i8')).to.have.style('display', 'flex');

        //Make false; Ie hide element by setting display to none.
        $('i8_1').checked = false;
        $('i8_1').dispatchEvent(new Event('change'));
        expect($('i8')).not.to.be.displayed;
        expect($('i8')).to.have.style('display', 'none');

        // Make truel show element and reset display to flex.
        $('i8_1').checked = true;
        $('i8_1').dispatchEvent(new Event('change'));
        expect($('i8')).to.be.displayed;
        expect($('i8')).to.have.style('display', 'flex');
        done();
      })      
      

    })

    describe('data-route tests', (done) => {
      it('change hash', async function () {
        await waitForNewHash('#/new')
        expect(document.location.hash === '#/new')
      })
      it('Route to rt0 without hash', async function () {
        expect($('rt0')).not.to.be.displayed;

        await waitForNewHash('')
        expect(document.location.hash === '')
        expect($('rt0')).to.be.displayed;

      })
      it('Route to rt0', async function () {
        // set back to #/new
        await waitForNewHash('#/new')

        const hash0 = '';

        expect($('rt0')).not.to.be.displayed;

        await waitForNewHash(`#/${hash0}`)
        expect(document.location.hash === `#/${hash0}`)
        expect($('rt0')).to.be.displayed;

      })

      it('Route to rt1', async function () {
        const hash1 = 'rt1';

        expect($('rt1')).not.to.be.displayed;

        await waitForNewHash(`#/${hash1}`)
        expect(document.location.hash === `#/${hash1}`)
        expect($('rt1')).to.be.displayed;

      })
      it('Route to rt2, default sub route', async function () {
        const hash2 = 'rt2';

        expect($('rt2')).not.to.be.displayed;

        await waitForNewHash(`#/${hash2}`)
        expect(document.location.hash === `#/${hash2}`)
        expect($('rt2')).to.be.displayed;
        expect($('srt2_0')).to.be.displayed;
        expect()

      })
      it('Route to rt2, subrt 1', async function () {
        const hash21 = 'rt2/srt1';

        expect($('srt2_1')).not.to.be.displayed;

        await waitForNewHash(`#/${hash21}`)
        expect(document.location.hash === `#/${hash21}`)
        expect($('rt2')).to.be.displayed;
        expect($('srt2_1')).to.be.displayed;
        expect()

      })
      it('Route to rt2, subrt 1', async function () {
        // set back to #/new
        await waitForNewHash('#/new')

        const hash22 = 'rt2/srt2';

        expect($('rt2')).not.to.be.displayed;
        expect($('srt2_2')).not.to.be.displayed;

        await waitForNewHash(`#/${hash22}`)
        expect(document.location.hash === `#/${hash22}`)
        expect($('rt2')).to.be.displayed;
        expect($('srt2_2')).to.be.displayed;
      })

      it('Route to rt3/subrt3/srt3', async function () {
        const hash3 = 'rt3/subrt3/srt3';

        expect($('rt3')).not.to.be.displayed;

        await waitForNewHash(`#/${hash3}`)
        expect(document.location.hash === `#/${hash3}`)
        expect($('rt3')).to.be.displayed;
      })

      it('Route to rt4 and set class class_rt4', async function () {
        const hash4 = 'rt4';

        expect($('rt4')).to.be.displayed;
        expect($('rt4')).not.to.have.class('class_rt4');

        await waitForNewHash(`#/${hash4}`)
        expect(document.location.hash === `#/${hash4}`)
        expect($('rt4')).to.be.displayed;
        expect($('rt4')).to.have.class('class_rt4');
      })

      it('Route to rt5/:value50', async function () {
        const hash5 = 'rt5/50';

        expect($('rt5')).not.to.be.displayed;

        await waitForNewHash(`#/${hash5}`)
        expect(document.location.hash === `#/${hash5}`)
        expect($('rt5')).to.be.displayed;
        expect($('rt5')).to.have.text('rt5/50');

      })
      it('Route to rt5/:value51', async function () {
        const hash51 = 'rt5/51';

        expect($('rt5')).to.be.displayed;

        await waitForNewHash(`#/${hash51}`)
        expect(document.location.hash === `#/${hash51}`)
        expect($('rt5')).to.be.displayed;
        expect($('rt5')).to.have.text('rt5/51');
      })

      it('Route to rt6, then to 61 and then back', async function () {
        const hash6 = 'rt6';

        expect($('rt6')).not.to.be.displayed;

        await waitForNewHash(`#/${hash6}`)
        expect(document.location.hash === `#/${hash6}`)
        expect($('rt6')).to.be.displayed;

        const hash61 = 'rt61';

        expect($('rt61')).not.to.be.displayed;

        await waitForNewHash(`#/${hash61}`)
        expect(document.location.hash === `#/${hash61}`)
        expect($('rt6')).not.to.be.displayed;
        expect($('rt61')).to.be.displayed;

        // Browser history back
        window.history.back();
        await waitFor(2000, () => document.location.hash===`#/${hash6}` && rt6.style.display == '')
        expect(document.location.hash === `#/${hash6}`)

        expect($('rt6')).to.be.displayed;
        expect($('rt61')).not.to.be.displayed;
      })

      it('Route to rt7 with a data-if attribute', async function () {
        const hash1 = 'rt7';

        expect($('rt7')).not.to.be.displayed;

        await waitForNewHash(`#/${hash1}`)
        expect(document.location.hash === `#/${hash1}`)
        expect($('rt7')).to.be.displayed;

      })

    })

    async function waitForNewHash(hash) {
      document.location.hash=hash;
      await waitFor(2000, () => document.location.hash==hash)
    }

    
    describe('data-action tests', () => {
      it('Press button to increment js number a0', (done) => {
        expect(a0).to.equal(0);

        $('a0').dispatchEvent(new Event('click'));

        expect(a0).to.equal(1);
        done();
      })
      it('Press button to decrement a1 and check the button text gets updated', (done) => {

        expect(a1).to.equal(10);
        expect($('a1')).to.have.text('Decrement a1 = 10')

        $('a1').dispatchEvent(new Event('click'));

        expect(a1).to.equal(9);
        expect($('a1')).to.have.text('Decrement a1 = 9')
        done();
      })
      it('Press div with data-action to increment js number a2', (done) => {
        expect(a2).to.equal(20);

        $('a2').dispatchEvent(new Event('click'));

        expect(a2).to.equal(21);
        done();
      })
      it('Press div in button with data-action to increment js number a3', (done) => {
        expect(a3).to.equal(30);

        $('a3b').dispatchEvent(new Event('click'));
        expect(a3).to.equal(31);

        $('a3b').setAttribute('disabled', '')
        $('a3b').dispatchEvent(new Event('click')); //should not execute
        expect(a3).to.equal(31); // and number stays the same

        done();
      })

    })
    describe('data-attr tests, initial value and after updated width and height js vars', () => {
      it('Init img dimensions from vars and then change with button press', (done) => {
        expect($('at0')).to.have.attribute('width', '64')
        expect($('at0')).to.have.attribute('height', '48')

        $('at1').dispatchEvent(new Event('click'));

        expect($('at0')).to.have.attribute('width', '32')
        expect($('at0')).to.have.attribute('height', '24')

        done();
      })
      it('Conditionally show boolean attribute', (done) => {
        expect($('at2')).to.not.have.attribute('disabled')

        $('at2').dispatchEvent(new Event('click'));

        expect($('at2')).to.have.attribute('disabled')

        done();
      })
      it('Check hyphenated attribute gets created', (done) => {
        expect($('at3')).to.have.attribute('data-at3','data-a3')
        done();
      })
    })
    describe('data-on tests', () => {
      it('Press button to increment js number a_0', (done) => {
        expect(o_0).to.equal(5);
        expect($('o0')).to.have.text('Increment o0 5')
        $('o0').dispatchEvent(new Event('click'));
        expect(o_0).to.equal(6);
        expect($('o0')).to.have.text('Increment o0 6')
        done();
      })
      it('Check for on change event.', (done) => {
        expect(o_1).to.equal('a');
        expect($('o1_0')).to.have.text('a')
        
        $('o1').value = 'z';
        $('o1').dispatchEvent(new Event('change'));
        expect(o_1).to.equal('z');
        expect($('o1_0')).to.have.text('z')
        done();
      })
      it('Check for on keypress up and down event.', (done) => {
        expect(o_2).to.equal('');
        expect($('o2_0')).to.have.text('')
        fireEvent($('o2'), "keydown", {keyCode: 120});
        expect(o_2).to.equal(120);
        expect($('o2_0')).to.have.text('120')
        fireEvent($('o2'), "keyup", {keyCode: 110});
        expect(o_2).to.equal(110);
        expect($('o2_0')).to.have.text('110')
        done();
      })
      it('data-value and a change listener on the same element', (done) => {
        expect(o_3).to.equal('abc');
        expect($('o3_0')).to.have.text('abc');
        $('o3').value = "ABC   ";
        fireEvent($('o3'), "value");
        expect($('o3_0')).to.have.text('ABC   ')
        fireEvent($('o3'), "change");
        expect($('o3_0')).to.have.text('ABC')
        done();
      })
    })
    describe('data-for tests', () => {
      it('Render 5 li\'s', (done) => {
        expect($('f0')).to.have.length(5)
        expect($('f0')).to.contain.text('OL')
        expect(document.querySelectorAll('ol#f0 li')).to.contain.text('5 elements')
        done();
      })
      it('Render 2 ol\'s with each 3 li\'s' , (done) => {
        expect($('f1')).to.have.length(2)
        expect(document.querySelectorAll('ol#f1 li')).to.have.length(6)
        expect(document.querySelectorAll('ol#f1 li')).to.contain.text(['3 x 2 elements'])
        done();
      })
      it('Render 5 li\'s with index stamped', (done) => {
        expect($('f2')).to.have.length(5)
        expect($('f2')).to.contain.text('UL')
        expect(document.querySelectorAll('ul#f2 li')).to.contain.text('5 elements')
        expect(document.querySelectorAll('ul#f2 li')).to.contain.text(['Element 1 of 5 elements','Element 3 of 5 elements','Element 5 of 5 elements'])
        done();
      })
      it('Render 2 ul\'s with each 3 li\'s' , (done) => {
        expect($('f3')).to.have.length(2)
        expect(document.querySelectorAll('ul#f3 li')).to.have.length(6)
        expect(document.querySelectorAll('ul#f3 li')).to.contain.text(['2 x 3 elements 0 - 1', '2 x 3 elements 1 - 2'])
        done();
      })
      it('Render 3 li\'s from an array with 3 elements and display index and array', (done) => {
        expect($('f4')).to.have.length(3)
        expect(document.querySelectorAll('ul#f4 li')).to.contain.text(['1 - Monkey','2 - Elephant','3 - Lion'])
        done();
      })
      it('Render 3 table rows with td \'s from an array with 3 objects and display index and object props', (done) => {
        expect($('f5')).to.have.length(3)
        expect(document.querySelectorAll('tbody#f5 td')).to.contain.text(['1','2','3'])
        expect(document.querySelectorAll('tbody#f5 td')).to.contain.text(['Karin','John','Maria'])
        expect(document.querySelectorAll('tbody#f5 td')).to.contain.text(['9047','4599','Done'])
        done();
      })
      it('Render 3 table rows with td \'s from an array with 3 objects. interact with number input, radio and button.', (done) => {
        expect($('f6')).to.have.length(3)
        expect(document.querySelectorAll('tbody#f6 td')).to.contain.text(['1','2','3'])
        expect(document.querySelectorAll('tbody#f6 td')).to.contain.text(['Karin','John','Maria'])
        let f6elem  = document.querySelector('#f6 > tr:nth-child(2) > td:nth-child(5) > input[type="number"]');
        expect(parseInt(f6elem.value)).to.equal(f6[1].steps);

        // Change steps in 2nd row.        
        f6elem.value = 10000;
        // Since dispatchEvent doesn't work on delegated event listeners, call listener directly
        fireEvent(f6elem, "value");
        expect(10000).to.equal(f6[1].steps);
        expect(document.querySelector('#f6 > tr:nth-child(2) > td:nth-child(6)')).to.contain.text('Done');

        //Select the third element element
        let f6_2_radio = document.querySelector('#f6 > tr:nth-child(3) > td:nth-child(1) > input[type="radio"]');
        fireEvent(f6_2_radio, "value");
        expect('2').to.equal(f6_selected);

        // Remove 2nd remove by "clicking" action button
        let f6_1_button = document.querySelector('#f6 > tr:nth-child(2) > td:nth-child(7) > button');
        //call delete click handler on the for node
        fireEvent(f6_1_button, "click");
        expect($('f6')).to.have.length(2)
        expect(document.querySelectorAll('tbody#f6 td')).to.contain.text(['1','2'])
        expect(document.querySelectorAll('tbody#f6 td')).to.contain.text(['Karin','Maria'])
        done();
      })
      it('Render 12 li\'s', (done) => {
        expect($('f7')).to.have.length(12)
        expect(document.querySelectorAll('ol#f7 li')).to.contain.text(['1 of 12 elements', '12 of 12 elements'])
        done();
      })
      it('Render 2 nested for loops with context action', (done) => {

        expect($('f81')).to.have.text("0 - 0")
        const f8Button1_1 = document.querySelector('#f8 > div > div:nth-child(2) > button:nth-child(2)')
        fireEvent(f8Button1_1, "click")
        expect($('f81')).to.have.text("1 - 1")
        done();
      })
      it('For loop with 2 action buttons on each loop item', (done) => {
        const f9Div = $('f9')
        const f9Row0Div = f9Div.querySelectorAll('div')[0];
        const f9Row1Div = f9Div.querySelectorAll('div')[1];

        const f9Row0Div1Span = f9Row0Div.querySelectorAll('span')[1];
        expect(f9Row0Div1Span).to.have.text('c0:1')
        const f9Row0Div2Span = f9Row0Div.querySelectorAll('span')[2];
        expect(f9Row0Div2Span).to.have.text('c1:10')
        const f9Row1Div1Span = f9Row1Div.querySelectorAll('span')[1];
        expect(f9Row1Div1Span).to.have.text('c0:100')
        const f9Row1Div2Span = f9Row1Div.querySelectorAll('span')[2];
        expect(f9Row1Div2Span).to.have.text('c1:110')

        const f9Row0Div0Button = f9Row0Div.querySelectorAll('button')[0];
        fireEvent(f9Row0Div0Button, "click")
        expect(f9Row0Div1Span).to.have.text('c0:2') //Changed
        expect(f9Row0Div2Span).to.have.text('c1:10')
        expect(f9Row1Div1Span).to.have.text('c0:100')
        expect(f9Row1Div2Span).to.have.text('c1:110')

        const f9Row0Div1Button = f9Row0Div.querySelectorAll('button')[1];
        fireEvent(f9Row0Div1Button, "click")
        expect(f9Row0Div1Span).to.have.text('c0:2')
        expect(f9Row0Div2Span).to.have.text('c1:11') //Changed
        expect(f9Row1Div1Span).to.have.text('c0:100')
        expect(f9Row1Div2Span).to.have.text('c1:110')

        const f9Row1Div1Button = f9Row1Div.querySelectorAll('button')[1];
        fireEvent(f9Row1Div1Button, "click")
        expect(f9Row0Div1Span).to.have.text('c0:2')
        expect(f9Row0Div2Span).to.have.text('c1:11') 
        expect(f9Row1Div1Span).to.have.text('c0:100')
        expect(f9Row1Div2Span).to.have.text('c1:111')
        done();
      })

      it('String array For loop with text output and input control', (done) => {
        expect($('f10')).to.have.length(3)
        expect(document.querySelectorAll('#f10 div span')).to.contain.text(['0','1','2'])
        expect(document.querySelectorAll('#f10 div span')).to.contain.text(['Charlie','Foxtrot','Tango'])
        let f10_2ndRowInput  = document.querySelector('#f10 > div:nth-child(2) > input');
        f10_2ndRowInput.value = 'Alpha'
        fireEvent(f10_2ndRowInput, "value");
        expect(document.querySelectorAll('#f10 div span')).to.contain.text(['Charlie','Alpha','Tango'])
        done();
      })

      it('String array For loop with text output and input control in 3 for loop leaf elements', (done) => {
        expect($('f11')).to.have.length(9)
        expect(document.querySelectorAll('#f11 span')).to.contain.text(['0','1','2'])
        expect(document.querySelectorAll('#f11 span')).to.contain.text(['Charlie','Foxtrot','Tango'])
        let f11_2ndRowInput  = document.querySelectorAll('#f11 > input')[1];
        f11_2ndRowInput.value = 'Alpha'
        fireEvent(f11_2ndRowInput, "value");
        expect(document.querySelectorAll('#f11 span')).to.contain.text(['Charlie','Alpha','Tango'])
        done();
      })
      it('Render 2 nested for loops with context action on an inner for loop with 3 direct children', (done) => {

        expect($('f121')).to.have.text("0 - 0 - 0")
        const f12Button1_1_1 = document.querySelector('#f12 > div > div:nth-child(2) > button:nth-child(5)')
        fireEvent(f12Button1_1_1, "click")
        expect($('f121')).to.have.text("1 - 1 - 1")
        done();
      })

      it('Load data in an array, which starts out undefined', async function () {
        await waitFor(2000, () => checkForClass($('f13'), "reken-rest-done"));
        expect($('f13')).to.have.length(3);
      })

      it('Render first 3 elements', (done) => {
        expect($('f14')).to.have.length(3)
        expect($('f14')).to.contain.text('OL')
        expect(document.querySelectorAll('ol#f14 li')).to.contain.text('Element 2-2')
        done();
      })

      it('Render Element 3 to 5', (done) => {
        expect($('f15')).to.have.length(2)
        expect($('f14')).to.contain.text('OL')
        expect(document.querySelectorAll('ol#f15 li')).to.contain.text('Element 1-4')
        done();
      })

    })
    describe('data-calc tests', () => {
      it('Render a the value of js var, update with calc tagged script', (done) => {
        expect($('ca0')).to.have.text('10')
        done();
      })

      it('Render a the value of js var, update with calc tagged script', (done) => {
        expect($('ca1')).to.have.text('11')

        $('ca1_0').value = 11
        fireEvent($('ca1_0'), "value")
        expect($('ca1')).to.have.text('21')

        fireEvent($('ca1_1'), "click")
        expect($('ca1')).to.have.text('31')

        done();
      })

      it('Switch focus between 2 input controls', (done) => {
        ca20 = false
        fireEvent($('ca2_2'), "click")
        assert($('ca2_0')===document.activeElement, "ca2_0 has focus")
        fireEvent($('ca2_2'), "click")
        assert($('ca2_1')===document.activeElement, "ca2_1 has focus")
        done();
      })
    })

    checkForClass = (elem, className) => {
      return elem.classList.contains(className)
    }

    describe('data-rest tests', () => {
      it('Load a value from json file and display in a div thru js var r0.theNumber', async function () {

        await waitFor(2000, () => checkForClass($('r0'), "reken-rest-done"));
        expect($('r0')).to.have.text('1')

      })
      it('Load a value from json file then load a value from another file', async function () {

        await waitFor(2000, () => checkForClass($('r1'), "reken-rest-done"));
        expect($('r1')).to.have.text('1')

        // Now chance select to 2
        r1_0.value = "two"
        r1_0.dispatchEvent(new Event("change"))

        await waitFor(2000, () => checkForClass($('r1'), "reken-rest-done"));
        expect($('r1')).to.have.text('2')

      })
      it('Load an array from a json file and point to the array data with path', async function () {
        await waitFor(2000, () => checkForClass($('r2'), "reken-rest-done"));
        expect($('r2')).to.have.length(3)
        expect(document.querySelectorAll('#r2 li')).to.contain.text(['Arnold','Bob','Chris'])
      })
      it('Load an object with options, method=DELETE should fail', async function () {
        await waitFor(2000, () => checkForClass($('r3'), "reken-rest-error"));
        assert(r3_options['reken_rest_status'] === 'reken-rest-error', "Options should show have eken_rest_status prop with val reken-rest-error");
      })
      it('Load an object with options, method=GET should pass', async function () {
        await waitFor(2000, () => checkForClass($('r4'), "reken-rest-done"));
        assert(r4_options['reken_rest_status'] === 'reken-rest-done', "Options should have eken_rest_status prop with val reken-rest-done");
        assert(r4_options['r4_callback_valid'] === true, "Call back is called with optiond and json string");
      })
      it('Load a value from json file, by setting the fetch option to true', async function () {
        expect($('r5')).to.have.text('0')

        $('r5_button').dispatchEvent(new Event('click'));

        await waitFor(2000, () => checkForClass($('r5'), "reken-rest-done"));
        expect($('r5')).to.have.text('1')
      })
      it('Load json file, check that the response is set on the options after the call', async function () {
        await waitFor(2000, () => checkForClass($('r6'), "reken-rest-done"));
        assert(typeof r6_options.response === 'object', "Options should contain response object")
        assert(r6_options.response.ok, "Response property ok should be true")
      })
      it('Load text file and convert into an object', async function () {
        await waitFor(2000, () => checkForClass($('r7'), "reken-rest-done"));
        expect($('r7')).to.have.text('1')
      })
      it('Load json file in component r8_0 and check for the value', async function () {
        await waitFor(2000, () => checkForClass($('r8_0'), "reken-rest-done"));
        expect($('r8_0')).to.have.text('zero')
      })
      it('Load json file in component r8_1 and check for the value', async function () {
        await waitFor(2000, () => checkForClass($('r8_1'), "reken-rest-done"));
        expect($('r8_1')).to.have.text('one')
      })
      it('Load JSON file and use array syntax path to get 2nd element', async function () {
        await waitFor(2000, () => checkForClass($('r9'), "reken-rest-done"));
        expect($('r9')).to.have.text('bananas');
      })
      it('Load JSON file and use reviver options prop to convert date string to Date', async function () {
        await waitFor(2000, () => checkForClass($('r10'), "reken-rest-done"));
        assert(r10[1].sell_by instanceof Date, "Reviver not converting to sell_by field to Date")
      })


    })
    describe('data-calc tests', () => {
      it('Render a the value of js var, update with calc tagged script', (done) => {
        expect($('ca0')).to.have.text('10')
        done();
      })
    })

    describe('data-component tests', () => {
      it('Verify the component is rendered', (done) => {
        expect($('cp0')).to.have.text('Component 0')
        done();
      })
      it('Verify components arguments', (done) => {
        expect($('cp1')).to.have.text('default valueundefined')
        expect($('cp1_0')).to.have.text('arg passed inundefined')
        expect($('cp1_1')).to.have.text('data-text valueundefined')
        expect($('cp1_2')).to.have.text('data-text valueundefined')
        expect($('cp1_3')).to.have.text('01')
        expect($('cp1_4')).to.have.text('justAStringNotAVarundefined')
        done();
      })
      it('Verify components state', (done) => {
        expect($('cp2')).to.have.text('arg-10-Hello-10Hello-30')
        done();
      })
      it('Verify updated componentent state', (done) => {
        const cp3output = document.querySelector('#cp3 > div')
        expect(cp3output).to.contain.html('<em>10</em>')
        const cp3input = document.querySelector('#cp3 input')
        cp3input.value = 20
        cp3input.dispatchEvent(new Event('change'));
        expect(cp3output).to.contain.html('<em>20</em>')

        done();
      })
      it('Nested components', (done) => {
        const cp4output = document.querySelector('#cp4 > [data-component=comp40] > div')
        expect(cp4output).to.contain.html('<em>100-arg-10</em>')

        const cp4input = document.querySelector('#cp4 > input')
        cp4input.value = 20
        cp4input.dispatchEvent(new Event('change'));
        expect(cp4output).to.contain.html('<em>100-arg-20</em>')

        const cp40input = document.querySelector('#cp4 > [data-component=comp40] > input')
        cp40input.value = 120
        cp40input.dispatchEvent(new Event('change'));
        expect(cp4output).to.contain.html('<em>120-arg-20</em>')

        const cp40button = document.querySelector('#cp4 > [data-component=comp40] > button')
        cp40button.dispatchEvent(new Event('click'));
        expect(cp4output).to.contain.html('<em>200-arg-20</em>')
        done();
      })
      it('Component in a for loop', (done) => {
        expect($('cp5')).to.have.length(3);
        expect(document.querySelectorAll('ul#cp5 li span')).to.contain.text(['comp 5 instance 1 - 10','comp 5 instance 2 - 10','comp 5 instance 3 - 10'])

        const cp52input = document.querySelector('#cp5 > [data-component=comp5]:nth-child(2) > input')
        cp52input.value = 20
        cp52input.dispatchEvent(new Event('change'));
        expect(document.querySelectorAll('ul#cp5 li span')).to.contain.text(['comp 5 instance 1 - 10','comp 5 instance 2 - 20','comp 5 instance 3 - 10'])

        const cp53button = document.querySelector('#cp5 > [data-component=comp5]:nth-child(3) > button')
        cp53button.dispatchEvent(new Event('click'));
        expect(document.querySelectorAll('ul#cp5 li span span')).to.contain.text(['comp 5 instance 1 - 10','comp 5 instance 2 - 20','comp 5 instance 3 - 100'])
        done();
      })

      it('Loop in a component', (done) => {
        const cp6div = document.querySelector('#cp6')
        const cp6Ul = document.querySelector('#cp6 > ul')
        expect(cp6Ul).to.have.length(3);
        const cp6Summary = document.querySelector('#cp6 > .summary')
        expect(cp6Summary).to.have.text('arr_elems: 10,20,30')
        expect(document.querySelectorAll('#cp6 > ul span')).to.contain.text(['comp 6 instance 1 - 10','comp 6 instance 2 - 20','comp 6 instance 3 - 30'])

        //Update 2nd row value
        const cp62input = document.querySelector('#cp6 > ul > li:nth-child(2) > input')
        cp62input.value = 120
        //Process change event of input control
        fireEvent(cp62input, "value");
        expect(cp6Ul).to.have.length(3);
        expect(cp6Summary).to.have.text('arr_elems: 10,120,30')
        expect(document.querySelectorAll('#cp6 > ul span')).to.contain.text(['comp 6 instance 1 - 10','comp 6 instance 2 - 120','comp 6 instance 3 - 30'])

        //Update 2nd row value with button
        const cp62button = document.querySelector('#cp6 > ul > li:nth-child(2) > button.update')
        fireEvent(cp62button, "click")
        expect(cp6Ul).to.have.length(3);
        expect(cp6Summary).to.have.text('arr_elems: 10,100,30')
        expect(document.querySelectorAll('#cp6 > ul span')).to.contain.text(['comp 6 instance 1 - 10','comp 6 instance 2 - 100','comp 6 instance 3 - 30'])

        //Remove 2nd row with button
        const cp63button = document.querySelector('#cp6 > ul > li:nth-child(2) > button.delete')
        fireEvent(cp63button, "click")
        expect(cp6Ul).to.have.length(2);
        expect(cp6Summary).to.have.text('arr_elems: 10,30')
        expect(document.querySelectorAll('#cp6 > ul span')).to.contain.text(['comp 6 instance 1 - 10','comp 6 instance 2 - 30'])

        //Add row at the end.
        const cp600AddButton = document.querySelector('#cp600');
        fireEvent(cp600AddButton, "click");
        expect(cp6Summary).to.have.text('arr_elems: 10,30,300')
        expect(document.querySelectorAll('#cp6 > ul span')).to.contain.text(['comp 6 instance 1 - 10','comp 6 instance 2 - 30','comp 6 instance 3 - 300'])

        //Remove row at the end.
        const cp601DeleteButton = document.querySelector('#cp601');
        fireEvent(cp601DeleteButton, "click")
        expect(cp6Summary).to.have.text('arr_elems: 10,30')
        expect(document.querySelectorAll('#cp6 > ul span')).to.contain.text(['comp 6 instance 1 - 10','comp 6 instance 2 - 30'])

        done();
      })

      it('Nested components within loops with inputs and buttons', (done) => {
        const cp7Comp = document.querySelector('#cp7');
        const cp7Span = document.querySelector('#cp7 > span > span ')
        expect(cp7Span).to.have.text('1')

        const cp7Div = document.querySelector('#cp7 > div');
        expect(cp7Div).to.have.length(2);

        const cp72Comp = document.querySelector('#cp7 > div > div:nth-child(2)');
        const cp72Span = cp72Comp.querySelector('span > span');
        expect(cp72Span).to.have.text('3')

        const cp72Div = cp72Comp.querySelector('div');
        expect(cp72Div).to.have.length(3);

        const cp722Comp = cp72Div.querySelector('span:nth-child(2)');
        const cp722Span = cp722Comp.querySelector('span');
        expect(cp722Span).to.have.text('10')

        //Change value with input control in outer component
        const cp7Input = document.querySelector('#cp7 > span > input ')
        cp7Input.value = 5;
        fireEvent(cp7Input, "value");
        expect(cp7Span).to.have.text('5') // Changed to 5
        expect(cp72Span).to.have.text('3') // not changed
        expect(cp722Span).to.have.text('10') // not changed

        // Find sibling rows, so we can check they are not affected
        const cp71Comp = document.querySelector('#cp7 > div > div:nth-child(1)');
        const cp71Span = cp71Comp.querySelector('span > span');

        const cp721Comp = cp72Div.querySelector(':nth-child(1)');
        const cp721Span = cp721Comp.querySelector('span');


        //Change value with input control in 2nd row in middle component
        const cp72Input = cp72Comp.querySelector('span > input');
        cp72Input.value = 7
        fireEvent(cp72Input, "value");
        expect(cp7Span).to.have.text('5') // Not changed
        expect(cp72Span).to.have.text('7') // Changed to 7
        expect(cp722Span).to.have.text('10') // Not changed
        //Siblings not changed
        expect(cp71Span).to.have.text('3') // Not Changed        
        expect(cp721Span).to.have.text('10') // Not Changed          

        //Change value with input control in 2nd row in inner component
        const cp722Input = cp722Comp.querySelector('input');
        cp722Input.value = 42
        fireEvent(cp722Input, "value")
        expect(cp7Span).to.have.text('5') // Not changed
        expect(cp72Span).to.have.text('7') // Not changed
        expect(cp722Span).to.have.text('42') // Changed to 42
        //Siblings not changed
        expect(cp71Span).to.have.text('3') // Not Changed        
        expect(cp721Span).to.have.text('10') // Not Changed          

        //Reset value with button in 2nd row in inner component
        const cp722Button = cp722Comp.querySelector('button');
        fireEvent(cp722Button, "click")
        expect(cp7Span).to.have.text('5') // Not changed
        expect(cp72Span).to.have.text('7') // Not changed
        expect(cp722Span).to.have.text('0') // Reset to 0

        //Siblings not changed
        expect(cp71Span).to.have.text('3') // Not Changed        
        expect(cp721Span).to.have.text('10') // Not Changed          
        done();
      })

      it('Verify component state in for loop', (done) => {
        const cp8 = document.querySelector('#cp8')
        const cp81Div = document.querySelector('#cp8 > :nth-child(1)');
        const cp82Div = document.querySelector('#cp8 > :nth-child(2)');
        const cp83Div = document.querySelector('#cp8 > :nth-child(3)');

        let cp81Checkbox = cp81Div.querySelector('input')
        let cp82Checkbox = cp82Div.querySelector('input')
        let cp83Checkbox = cp83Div.querySelector('input')

        expect(cp81Checkbox.checked).to.be.true;
        expect(cp82Checkbox.checked).to.be.true;
        expect(cp83Checkbox.checked).to.be.true;

        cp82Checkbox.checked = false;
        fireEvent(cp82Checkbox, "value");
        expect(cp81Checkbox.checked).to.be.true;
        expect(cp82Checkbox.checked).to.be.false;
        expect(cp83Checkbox.checked).to.be.true;


        cp83Checkbox.checked = false;
        fireEvent(cp83Checkbox, "value");

        const cp8Delete = document.querySelector('#cp8Delete')
        fireEvent(cp8Delete, "click");

        cp81Checkbox = document.querySelector('#cp8 > div:not([style*="display: none"]):nth-child(1)>input')
        cp82Checkbox = document.querySelector('#cp8 > div:not([style*="display: none"]):nth-child(2)>input')
        expect(cp81Checkbox.checked).to.be.true;
        expect(cp82Checkbox.checked).to.be.false;
        done();
      })

      it('Verify component style get applied', (done) => {
        const brown9  = 'rgb(165, 42, 42)'
        const gray9   = 'rgb(128, 128, 128)'
        const silver9 = 'rgb(192, 192, 192)'
        const cp9 = $('cp9');
        const ul9 = $('cp9_0');
        const li9_0 = document.querySelector('#cp9 > li:first-child');
        const li9_1 = document.querySelector('#cp9 > li:nth-child(2)');
        const li9_3 = document.querySelector('#cp9 > li:nth-child(4)');
        const cp9_h3 = $('cp9_h0');

        expect(window.getComputedStyle(cp9, null).backgroundColor).to.equal(brown9) //brown
        expect(window.getComputedStyle(li9_0, null).backgroundColor).to.equal(gray9) //gray not selected
        expect(window.getComputedStyle(li9_1, null).backgroundColor).to.equal(gray9) //gray not selected
        expect(window.getComputedStyle(li9_3, null).backgroundColor).to.equal(silver9) // silver selected
        expect(cp9_h3).to.have.text("Selected:[3]");


        const li9_1Input = li9_1.querySelector('input')
        li9_1Input.checked = true;
        fireEvent(li9_1Input, "value");
        expect(window.getComputedStyle(cp9, null).backgroundColor).to.equal(brown9) //brown
        expect(window.getComputedStyle(li9_0, null).backgroundColor).to.equal(gray9) //gray not selected
        expect(window.getComputedStyle(li9_1, null).backgroundColor).to.equal(silver9) //gray not selected
        expect(window.getComputedStyle(li9_3, null).backgroundColor).to.equal(silver9) // silver selected
        expect(cp9_h3).to.have.text("Selected:[3,1]");
        
        done();
      })
      it('Verify component recalc is executed', (done) => {
        let cp10subdiv =  document.querySelector('#cp10 > div:first-child');
        expect(cp10subdiv).to.have.text('20')
        $('cp10Recalc').dispatchEvent(new Event('click'));
        expect(cp10subdiv).to.have.text('30')
        done();
      })
      it('Verify component bound arguments are updated', (done) => {
        // First component instance
        let cp11div0 = $('cp11_0')
        let cp11_0subdiv0 =  cp11div0.querySelectorAll('div')[0];
        let cp11_0subdiv1 =  cp11div0.querySelectorAll('div')[1];
        let cp11_01 = $('cp11_01')

        expect(cp11_0subdiv0).to.have.text('10')
        expect(cp11_0subdiv1).to.have.text('11')
        expect(cp11_01).to.have.text('10 - 11')

        fireEvent(cp11div0.querySelectorAll('button')[0], "click") // Set bind1 to setval value
        expect(cp11_0subdiv0).to.have.text('20')
        expect(cp11_0subdiv1).to.have.text('11')
        expect(cp11_01).to.have.text('20 - 11')

        fireEvent(cp11div0.querySelectorAll('button')[1], "click") // Increment bind2 value
        expect(cp11_0subdiv0).to.have.text('20')
        expect(cp11_0subdiv1).to.have.text('12')

        // Second component instance
        let cp11div1 = $('cp11_1')
        let cp11_1subdiv0 =  cp11div1.querySelectorAll('div')[0];
        let cp11_1subdiv1 =  cp11div1.querySelectorAll('div')[1];
        let cp11_11 = $('cp11_11')

        expect(cp11_1subdiv0).to.have.text('110')
        expect(cp11_1subdiv1).to.have.text('111')
        expect(cp11_11).to.have.text('110 - 111 - 130')

        fireEvent(cp11div1.querySelectorAll('button')[0], "click") // Set bind1 to setval value
        expect(cp11_1subdiv0).to.have.text('130')
        expect(cp11_1subdiv1).to.have.text('111')
        expect(cp11_11).to.have.text('130 - 111 - 130')

        fireEvent(cp11div1.querySelectorAll('button')[1], "click") // Increment bind2 value
        expect(cp11_1subdiv0).to.have.text('130')
        expect(cp11_1subdiv1).to.have.text('112')
        expect(cp11_11).to.have.text('130 - 112 - 130')

        expect(cp11_1subdiv1).to.have.text('112')
        fireEvent(cp11div1.querySelectorAll('button')[2], "click") // Increment setval value; should not propagate outside of component as it is an arg not a bind parameter
        expect(cp11_11).to.have.text('130 - 112 - 130')
        done();
      })

      it('Verify when component data-if is false it does not execute children code', (done) => {
        let cp12div = $('cp12')
        let cp12_subdiv = cp12.querySelector('div');
        expect(cp12_subdiv).to.have.text('Is not active')
        $('cp12_1').checked = true
        fireEvent($('cp12_1'), 'value')
        expect(cp12_subdiv).to.have.text('Is active')
        done();
      })

      it('Verify a for loop item can be passed as an argument', (done) => {
        let cp13ul = $('cp13')
        expect(cp13ul).to.have.length(2);
        expect(cp13ul.querySelectorAll('li')[0]).to.have.text('comp 13 name John');
        expect(cp13ul.querySelectorAll('li')[1]).to.have.text('comp 13 name Mary');
        done();
      })
      it('Verify a component has the right component styling and text', (done) => {
        let cp14div = $('cp14_0')
        expect(cp14div).to.have.text('Untouched');
        expect(cp14div).to.have.style('border-color', 'rgb(255, 0, 0)');
        expect(cp14div).to.have.style('border-width', '1px');
        expect(cp14div).to.have.style('border-style', 'solid');
        expect(cp14div).to.have.style('background-color', 'rgb(0, 0, 255)');
        expect(cp14div).to.have.style('color', 'rgb(255, 255, 255)');
        done();
      })
      it('Override component style', (done) => {
        let cp14div = $('cp14_1')
        expect(cp14div).to.have.text('Override style');
        expect(cp14div).to.have.style('border-color', 'rgb(255, 0, 0)');
        expect(cp14div).to.have.style('border-width', '1px');
        expect(cp14div).to.have.style('border-style', 'solid');
        expect(cp14div).to.have.style('background-color', 'rgb(255, 255, 0)');
        expect(cp14div).to.have.style('color', 'rgb(0, 0, 0)');
        done();
      })
      it('Override component class', (done) => {
        let cp14div = $('cp14_2')
        expect(cp14div).to.have.text('Override class');
        expect(cp14div).to.have.style('border-color', 'rgb(0, 128, 0)');
        expect(cp14div).to.have.style('border-width', '10px');
        expect(cp14div).to.have.style('border-style', 'solid');
        expect(cp14div).to.have.style('background-color', 'rgb(0, 0, 255)');
        expect(cp14div).to.have.style('color', 'rgb(255, 255, 255)');
        done();
      })
      it('Hide component with if', (done) => {
        let cp14div = $('cp14_3')
        expect(cp14div).to.have.text('Shown');
        expect(cp14div).to.have.style('display', 'block');

        let cp14Checkbox = $('cp14_3c')
        cp14Checkbox.checked=false;
        cp14Checkbox.dispatchEvent(new Event('change'));
        expect(cp14div).to.have.text('Shown');
        expect(cp14div).to.have.style('display', 'none');
        done();
      })
      it('Component internally hidden should stay hidden', (done) => {
        let cp14div = $('cp14_4')
        expect(cp14div).to.have.text('Default');
        expect(cp14div).to.have.style('display', 'none');

        let cp14Checkbox = $('cp14_4c')
        cp14Checkbox.checked=false;
        cp14Checkbox.dispatchEvent(new Event('change'));
        expect(cp14div).to.have.text('Default');
        expect(cp14div).to.have.style('display', 'none');
        done();
      })
      it('Use component default action', (done) => {
        let cp16text = $('cp16text')
        expect(cp16text).to.have.text('');
        let cp16div = $('cp16_0')
        expect(cp16div).to.have.text('default action');
        cp16div.dispatchEvent(new Event('click'));
        expect(cp16text).to.have.text('inner');
        done();
      })
      it('Override component action', (done) => {
        let cp16text = $('cp16text')
        expect(cp16text).to.have.text('inner');
        let cp16div = $('cp16_1')
        expect(cp16div).to.have.text('instance action');
        cp16div.dispatchEvent(new Event('click'));
        expect(cp16text).to.have.text('outer');
        done();
      })
      it('Override component data-attr', (done) => {
        expect($('cp17_0')).to.not.have.attribute('disabled')
        expect($('cp17_1')).to.have.attribute('disabled')
        done();
      })
      it('Set component instance with data-calc ', (done) => {
        expect($('cp22div')).to.not.have.text('0');
        done();
      })
      it('Fire custom event from component', (done) => {
        expect($('cp23_div')).to.have.text('0-');
        const cp23button = $('cp23div').querySelector('button')
        cp23button.dispatchEvent(new Event('click'));
        expect($('cp23_div')).to.have.text('1-OK');
        done();
      })
      it('Nest same component with slot', (done) => {
        expect($('cp24')).to.have.length(3);
        expect($('cp24').children[0]).to.have.text('argument 1')
        expect($('cp24').children[2]).to.have.text('bind 1')
        expect($('cp24').children[1].children[0]).to.have.text('Hello');
        expect($('cp24').children[1]).to.contain.text('Henry');
        expect($('cp24').children[1].children[1]).to.have.text('US');
        done();
      })
      it('Nest 2 different components with slot', (done) => {
        expect($('cp25a')).to.have.length(3);
        expect($('cp25a').children[0]).to.have.text('a - argument 1')
        expect($('cp25a').children[2]).to.have.text('a - bind 1')
        expect($('cp25a').children[1].children[0]).to.have.text('b - argument 1');
        expect($('cp25a').children[1].children[2]).to.have.text('b - bind 1');
        expect($('cp25a').children[1].children[1].children[0]).to.have.text('a - argument 1');
        expect($('cp25a').children[1].children[1].children[2]).to.have.text('a - bind 1');
        expect($('cp25a').children[1].children[1].children[1].children[0]).to.have.text('b - argument 1');
        expect($('cp25a').children[1].children[1].children[1].children[1]).to.have.text('b - bind 1');
        done();
      })

      it('Nest 2 different components within for-loops', (done) => {
        expect($('cp26')).to.have.length(2);
        expect($('cp26').children[0].children[0]).to.have.text('pre - 0')
        expect($('cp26').children[0].children[1]).to.have.text('26a slot 0-button')
        expect($('cp26').children[0].children[2].children[0].children[0]).to.have.text('pre - 0:0')
        expect($('cp26').children[0].children[2].children[0].children[2]).to.have.text('26b 0:0-button')
        expect($('cp26').children[0].children[3]).to.have.text('26a 0-button')
        expect($('cp26').children[0].children[4]).to.have.text('post - 0')
        expect($('cp26').children[1].children[0]).to.have.text('pre - 1')
        expect($('cp26').children[1].children[1]).to.have.text('26a slot 1-button')
        expect($('cp26').children[1].children[2].children[1].children[2]).to.have.text('26b 1:1-button')
        expect($('cp26').children[1].children[2].children[1].children[3]).to.have.text('post - 1:1')
        expect($('cp26').children[1].children[4]).to.have.text('post - 1')

        fireEvent($('cp26').children[0].children[3],'click');
        expect($('cp26Text')).to.have.text('26a 0-button')

        fireEvent($('cp26').children[0].children[2].children[0].children[2],'click');
        expect($('cp26Text')).to.have.text('26b 0:0-button')

        fireEvent($('cp26').children[1].children[2].children[1].children[2],'click');
        expect($('cp26Text')).to.have.text('26b 1:1-button')

        fireEvent($('cp26').children[0].children[1],'click');
        expect($('cp26Text')).to.have.text('26a slot 0-button')

        fireEvent($('cp26').children[1].children[1],'click');
        expect($('cp26Text')).to.have.text('26a slot 1-button')

        done();
      })

      it('Nest 2 different components with embeddedfor-loops', (done) => {
        expect($('cp27')).to.have.length(1);
        expect($('cp27').children[0]).to.have.length(6);
        expect($('cp27').children[0].children[0]).to.have.text('pre - 0')
        expect($('cp27').children[0].children[5]).to.have.text('post - 1')
        expect($('cp27').children[0].children[4]).to.have.length(1);
        expect($('cp27').children[0].children[4].children[0]).to.have.length(6);
        expect($('cp27').children[0].children[4].children[0].children[0]).to.have.text('pre - 1:0')
        expect($('cp27').children[0].children[4].children[0].children[5]).to.have.text('post - 1:1')
        expect($('cp27').children[0].children[4].children[0].children[1]).to.have.text('span27 1:0')
        expect($('cp27').children[0].children[4].children[0].children[4]).to.have.text('span27 1:1')
        done();
      })
      it('Nested component with actions', (done) => {
        const cp28 = $('cp28a');
        const cp28Text = $('cp28aText')
        fireEvent(cp28.children[0], 'click');
        expect(cp28Text).to.have.text('28a outer-before')

        fireEvent(cp28.children[1], 'click');
        expect(cp28Text).to.have.text('28a outer-slot')

        fireEvent(cp28.children[3], 'click');
        expect(cp28Text).to.have.text('28a outer-after')

        fireEvent(cp28.children[2].children[0], 'click');
        expect(cp28Text).to.have.text('28a inner-before')

        fireEvent(cp28.children[2].children[1], 'click');
        expect(cp28Text).to.have.text('28a inner-slot')

        fireEvent(cp28.children[2].children[2], 'click');
        expect(cp28Text).to.have.text('28a inner-after')

        done();
      })
      it('Nested slot pass arg and bind value through', (done) => {
        const cp29 = $('nested29');
        const cp29Text = $('cp29Text')

        expect(cp29Text).to.have.text('value29')

        expect(cp29).to.have.length(4);
        expect(cp29.children[0]).to.have.text('value29-42')
        expect(cp29.children[2]).to.have.text('value29-42')
        expect(cp29.children[3].children[0]).to.have.value('value29')

        const cp29Nested = cp29.children[1];
        expect(cp29Nested).to.have.length(4);
        expect(cp29Nested.children[0]).to.have.text('value29-42')
        expect(cp29Nested.children[2]).to.have.text('value29-42')
        expect(cp29Nested.children[3].children[0]).to.have.value('value29')

        // Change input value in outer input control
        cp29.children[3].children[0].value = 'value29_1'
        fireEvent(cp29.children[3].children[0], 'value')

        expect(cp29Text).to.have.text('value29_1')
        expect(cp29.children[0]).to.have.text('value29_1-42')
        expect(cp29Nested.children[2]).to.have.text('value29_1-42')
        expect(cp29Nested.children[3].children[0]).to.have.value('value29_1')

        // Change input value in inner input control
        cp29Nested.children[3].children[0].value = 'value29_2'
        fireEvent(cp29Nested.children[3].children[0], 'value')

        expect(cp29Text).to.have.text('value29_2')
        expect(cp29.children[0]).to.have.text('value29_2-42')
        expect(cp29Nested.children[2]).to.have.text('value29_2-42')
        expect(cp29.children[3].children[0]).to.have.value('value29_2')

        done();
      })
      it('Nested slots classes and styles', (done) => {
        const cp30 = $('nested30');
        const cp30Nested = cp30.children[0];
 
        expect(cp30).to.have.class('outer')
        expect(cp30).to.have.class('component')
        expect(cp30).to.have.style('padding', '48px')
        
        expect(cp30Nested).to.have.class('inner')
        expect(cp30Nested).to.have.class('component')
        expect(cp30Nested).to.have.style('padding', '32px')

        done();
      })
      it('Pass javascript reserved word as an argument, treated as a string', (done) => {
        expect(cp31).to.have.text('delete')
        done();
      })
      it('Pass array and object index value in obj argument', (done) => {
        expect(cp32).to.have.text('20')
        done();
      })

    })
    describe('data-component timer/interval tests', () => {
      it.skip('Check that timer we can add a component instance timer on top of a component timer ', async function () {
        const cp18_0 =  $('cp18_0');
        expect(cp18_0).to.have.text('orange');
        const cp18_1 =  $('cp18_1');
        expect(cp18_1).to.have.text('orange');

        cp18_0cb.checked = true;
        cp18_0cb.dispatchEvent(new Event('change'));
        await waitFor(200, () => cp18_0.textContent =='blue')
        expect(cp18_1).to.have.text('orange');

        cp18_1cb.checked = true;
        cp18_1cb.dispatchEvent(new Event('change'));
        await waitFor(200, () => cp18_1.textContent =='pink')        
      })
     it.skip('Check that timer we can add a component instance interval on top of a component interval ', async function () {
        const cp19_0 =  $('cp19_0');
        expect(cp19_0).to.have.text('orange');
        const cp19_1 =  $('cp19_1');
        expect(cp19_1).to.have.text('orange');

        cp19_0cb.checked = true;
        cp19_0cb.dispatchEvent(new Event('change'));
        await waitFor(200, () => cp19_0.textContent =='blue')
        expect(cp19_1).to.have.text('orange');

        cp19_1cb.checked = true;
        cp19_1cb.dispatchEvent(new Event('change'));
        await waitFor(200, () => cp19_1.textContent =='pink')        
      })
    })

    describe('data-component data-route tests', (done) => {
      it('change hash', async function () {
        await waitForNewHash('#/comp-route')
        expect(document.location.hash === '#/comp-route')
        expect($('cp20route')).to.have.class('cp20route');
        window.location.hash=""
      })
    })

    describe('data-component data-rest tests', () => {
      it('Put data-rest on a component instance', async function () {

        await waitFor(2000, () => checkForClass($('cp21'), "reken-rest-done"));
        
        expect($('cp21')).to.have.text('1')

      })
    })

    describe('shorthand tests', () => {
      it('Verify the shorthand component is rendered', (done) => {
        expect($('sh1')).to.have.text('short-hand1')
        done();
      })
      it('Verify the shorthand component with argument is rendered', (done) => {
        expect($('sh2')).to.have.text('short-hand2')
        done();
      })
      it('Verify the shorthand component within a shorthand componentwith data-text is rendered', (done) => {
        expect($('sh3').children[0]).to.have.text('sh3 - short-hand3')
        done();
      })
      /* See short-hand2 style rule in header */
      it('Verify the shorthand component with a short hand style selector gets applied', (done) => {
        expect($('sh2')).to.have.style('background-color', 'rgb(0, 128, 0)');
        done();
      })
    })
    describe('slot tests', () => {
      it('Check if default slot content is displayed', (done) => {
        const slot1 =  $('ts11').querySelector('slot');
        expect(slot1).to.have.text('Has no slot test') 
        done();
      })
      it('Check if slot content is displayed', (done) => {
        const ts12_h2 =  $('ts12').querySelector('h2');
        expect(ts12_h2).to.have.text('Has slot text') 
        done();
      })
      it('Check if sub component slot content is displayed', (done) => {
        const ts2_h2 =  $('ts21').querySelector('h2');
        expect(ts2_h2).to.have.text('Hello from the subslot') 
        done();
      })
    })
    describe('data-include tests', () => {
      it('Check if component comp-include1 from library.html is loaded and rendered', (done) => {
        const di_h1 =  $('di1').querySelector('h1');
        expect(di_h1).to.have.text('comp-include1') 
        const di_h3 =  $('di1').querySelector('h3');
        expect(di_h3).to.have.text('h3 comp include1')
        done();
      })
      it('Check if component sub-lib1 from sublibrary.html is loaded and rendered', (done) => {
        expect($('sdi1')).to.have.text('sub-library1')
        done();
      }) 
      it('Check if component comp-include2 from library2.html is loaded and rendered', (done) => {
        const di_h2 =  $('di2').querySelector('h1');
        expect(di_h2).to.have.text('comp-include2') 
        const di_h23 =  $('di2').querySelector('h3');
        expect(di_h23).to.have.text('h3 comp include2')
        done();
      })
      it('Check if component sub-lib2 from sublibrary2.html is loaded and rendered', (done) => {
        expect($('sdi2')).to.have.text('sub-library2')
        done();
      }) 
      it('Check that not found text is rendered for a library that is not found', (done) => {
        expect($('il0')).to.have.text('File includes/library3.html not found.')
        done();
      }) 
    })
    describe('data-timer tests', () => {
      it('Check that timer adds increments an integer', async function () {
        const ti0_i0 =  $('ti0');
        ti0_i0.checked = true;
        ti0_i0.dispatchEvent(new Event('change'));
        await waitFor(20, () => tii0>0)
        // Stop the timer now
        ti0_i0.checked = false;
        ti0_i0.dispatchEvent(new Event('change'));
      })
      it('Check that hidden timer not fires and then does when shown', async function () {
        await waitFor(20, () => tii1==0)
        const ti1_i0 =  $('ti1');
        ti1_i0.checked = true;
        ti1_i0.dispatchEvent(new Event('change'));
        await waitFor(20, () => tii1>0)
        // Stop the timer now
        ti1_i0.checked = false;
        ti1_i0.dispatchEvent(new Event('change'));

      })
      it('Check timers on for children each fire', async function () {
        const ti2 =  $('ti2');
        await waitFor(20, () => ti2.children.item(0).dataset.timed=='done')
        await waitFor(20, () => ti2.children.item(1).dataset.timed=='done')
        await waitFor(20, () => ti2.children.item(2).dataset.timed=='done')
      })

      it('Check component timer', async function () {
        const ti3_b =  $('ti3');
        const tmr3 = $('tic3')
        ti3_b.checked = true;
        ti3_b.dispatchEvent(new Event('change'));
        await waitFor(20, () => tmr3.textContent == "Count:1")
      })

      it('Check component timers in for loop', async function () {
        const ti4_b =  $('ti4');
        const tmr4 = $('tic4');

        ti4_b.checked = true;
        ti4_b.dispatchEvent(new Event('change'));

        await waitFor(20, () => tmr4.children.item(0).textContent=='Count:1')
        await waitFor(20, () => tmr4.children.item(1).textContent=='Count:1')
      })
    })
    describe('data-interval tests', () => {
      it('Check that interval increments an integer', async function () {
        const in0_0 =  $('in0');
        in0_0.checked = true;
        in0_0.dispatchEvent(new Event('change'));
        await waitFor(20, () => ini0>0)
        // Stop the timer now
        in0_0.checked = false;
        in0_0.dispatchEvent(new Event('change'));
      })
      it('Check that hidden interval not fires and then does when shown', async function () {
        await waitFor(20, () => ini1==0)
        const inb1_0 =  $('in1');
        inb1_0.checked = true;
        inb1_0.dispatchEvent(new Event('change'));
        await waitFor(20, () => ini1>0)
        // Stop the timer now
        inb1_0.checked = false;
        inb1_0.dispatchEvent(new Event('change'));
      })
      it('Check timers on for children each fire', async function () {
        const in2 =  $('in2');
        const ini2 =  $('ini2');
        ini2.checked = true;
        ini2.dispatchEvent(new Event('change'));
        await waitFor(5, () => parseInt(in2.children.item(0).dataset.timed)>1)
        await waitFor(5, () => parseInt(in2.children.item(1).dataset.timed)>1)
        await waitFor(5, () => parseInt(in2.children.item(2).dataset.timed)>1)
        ini2.checked = false;
        ini2.dispatchEvent(new Event('change'));
      })

      it('Check component timer', async function () {
        const in3_b =  $('in3');
        const inc3 = $('inc3')
        in3_b.checked = true;
        in3_b.dispatchEvent(new Event('change'));
        await waitFor(20, () => inc3.textContent == "Count:1")
      })

      it('Check component timers in for loop', async function () {
        const in4_b =  $('in4');
        const inc4 =  $('inc4');
        in4_b.checked = true;
        in4_b.dispatchEvent(new Event('change'));

        await waitFor(20, () => inc4.children.item(0).textContent=='Count:2')
        await waitFor(20, () => inc4.children.item(1).textContent=='Count:2')
      })
    })

    describe('data-ref tests', () => {
      it('Verify namespace reference on regular div works', (done) => {
        expect(rf0).to.have.text('Hello ref0')
        done();
      })
      it('Verify data-ref in for-loop', (done) => {
        ref1s.forEach((elem, index) => {assert(elem === rf1.children[index], "indexed ref != rf1 ")})
        done();
      })
      it('Verify data-ref loop action event', (done) => {
        fireEvent(rf1.children[1], "click");
        assert(ref1Save === rf1.children[1], "Incorrect ref after click")
        done();
      })
      it('Verify data-ref in nested for-loop', (done) => {
        assert(ref2s[0]===rf2.children[0].children[0]);
        assert(ref2s[3]===rf2.children[1].children[1]);
        done();
      })
      it('Verify data-ref nested loop action event', (done) => {
        fireEvent(rf2.children[1].children[1], "click");
        assert(ref2Save === rf2.children[1].children[1], "Incorrect ref after click")
        done();
      })

      it('Check component data-ref', (done) => {
        assert(ref3 === rf3, "Incorrect component instance ref")
        done();
      })

      it('Check component internal refs', (done) => {
        assert(rf3.dataset.refValue3==="20", "Incorrect top component ref value")
        assert(rf3.children[0].dataset.refValue3==="10", "Incorrect child component ref value")
        assert(rf3.children[2].dataset.refValue3==="30", "Incorrect child component ref value")
        done();
      })

    })

    describe('issue 17 test', () => {
      it('Test if global application variables are not shielded by reken local vars', (done) => {
        expect($('issue17_0')).to.contain.text('root');
        expect($('issue17_1')).to.contain.text('_v');
        expect($('issue17_2')).to.contain.text('isEventHandler');
        expect($('issue17_3')).to.contain.text('indexesInForAncestors');
        expect($('issue17_4')).to.contain.text('ctxIdx');
        expect($('issue17_5')).to.contain.text('_l');
        expect($('issue17_6')).to.contain.text('classRegistry');
        expect($('issue17_7')).to.contain.text('_main');
        expect($('issue17_8')).to.contain.text('processRestCall');
        expect($('issue17_9')).to.contain.text('disableTimers');
        expect($('issue17_10')).to.contain.text('_mainInstance');
        done();
      })
    })
    
    const fireEvent = (target, eventType, payLoad) => {
      let classRoot = target.parentElement;
      while (classRoot !== null && !('$class' in classRoot) ) {
        classRoot = classRoot.parentElement;
      }
      let _instance = classRoot.$class
      let event = {}
      if (payLoad)
        event = {...payLoad};
      event.target = target;
      let eventRefs = target.dataset['event_'+eventType].split(':')
      for (let ref of eventRefs) {
        if (ref!='' && _instance[ref]) _instance[ref](event)
      }
    }
    // Run the mocha tests
    mocha.run();
  }
  </script>
  <script src="../src/reken.js"></script>
</body>

</html>